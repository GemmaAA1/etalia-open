{% extends 'base.html' %}

{% load staticfiles %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/users.css' %}" type="text/css" >
{% endblock css %}

{% block title %} PubStream | Settings {% endblock %}


{% block content %}

<div class="container settings">
    <div class="row">
        <div id="stream-settings-section" class="col-md-8 col-md-offset-2">
            <h4><div id="message" class="text-center" style="padding-bottom: 20px;"></div></h4>
            <div class="col-md-3 text-right">
                <div class="title">
                    Stream
                    <br>
                    <a class="edit" href="javascript:" data-toggle="modal" data-target="#stream-settings-modal">Edit</a>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row">
                    <div class="col-md-9">
{#                        <h5>NLP model: <span id="stream_model">{{ user.settings.stream_model }}</span></h5>#}
                        <h5>Time range: <span id="stream_time_lapse">{{ user.settings.get_stream_time_lapse_display }}</span></h5>
                        <h5>Narrowness: <span id="stream_narrowness">{{ user.settings.get_stream_narrowness_display }}</span></h5>
{#                        <h5>Method: <span id="stream_method">{{ user.settings.stream_method }}</span></h5>#}
                        <h5>Last update: {{ user.streams.first.modified }}</h5>
                    </div>
                    <div class="col-md-3">
                        <h5>
                            <button id="update-stream" class="btn btn-primary btn-sm update" action="{% url 'feeds:reset-stream'  'main' %}">Reset now</button>
                            <span class="errors"></span>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="divider">
    <div class="row">
        <div id="trend-settings-section" class="col-md-8 col-md-offset-2">
            <h4><div id="message" class="text-center" style="padding-bottom: 20px;"></div></h4>
            <div class="col-md-3 text-right">
                <div class="title">
                    Trend
                <br>
                    <a class="edit" href="javascript:" data-toggle="modal" data-target="#trend-settings-modal">Edit</a>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row">
                    <div class="col-md-9">
{#                        <h5>NLP model: <span id="trend_model">{{ user.settings.trend_model }}</span></h5>#}
                        <h5>Time range: <span id="trend_time_lapse">{{ user.settings.get_trend_time_lapse_display }}</span></h5>
                        <h5>Narrowness: <span id="trend_narrowness">{{ user.settings.get_trend_narrowness_display }}</span></h5>
{#                        <h5>Method: <span id="trend_method">{{ user.settings.trend_method }}</span></h5>#}
                        <h5>Last update: {{ user.trends.first.modified }}</h5>
                    </div>
                    <div class="col-md-3">
                        <h5>
                            <button id="update-trend" class="btn btn-primary btn-sm update" action="{% url 'feeds:reset-trend'  'main' %}">Reset now</button>
                            <span class="errors"></span>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="divider">
    <div class="row">
        <div id="email-digest-settings-section" class="col-md-8 col-md-offset-2 affiliation">
            <div class="col-md-3 text-right">
                <div class="title">
                    Email digest
                    <br>
                    <a class="edit" href="javascript:" data-toggle="modal" data-target="#email-digest-settings-modal">Edit</a>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row">
                    <div class="col-md-9">
                        <h5>Frequency: <span id="email_digest_frequency">{{ user.settings.get_email_digest_frequency_display }}</span></h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="divider">
    <div class="row">
        <div class="col-md-8 col-md-offset-2 affiliation">
            <div class="col-md-3 text-right">
                <div class="title">
                    Library
                </div>
            </div>
            <div class="col-md-9">
                <div class="row">
                    <div class="col-md-9">
                        <h5>Last modified: {{ user.lib.modified }}</h5>
                    </div>
                    <div class="col-md-3">
                        <h5>
                            <button id="update-lib" class="btn btn-primary btn-sm update update" action="{% url 'user:update-library' %}">Sync now</button>
                            <span class="errors"></span>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr class="divider">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="col-md-3 text-right">
                <div class="title">
                    Delete account
                </div>
            </div>
            <div class="col-md-9">
                <div class="row">
                    <div class="col-md-9">
                        <h5>Last login: {{ user.last_login }}</h5>
                    </div>
                    <div class="col-md-3">
                        <form role="form" method="GET" action="{% url 'user:delete-user' %}">
                            <button id="delete" type="submit" class="btn btn-danger btn-md">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'user/settings_modal.html' %}

</div>

{% endblock content %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'js/user.js' %}"></script>
    <script>
        $(function() {
            $( "#time_slider" ).slider();
            $( "#focus_slider" ).slider();
        });
    </script>
{% endblock js %}