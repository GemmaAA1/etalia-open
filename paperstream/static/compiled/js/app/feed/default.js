define("app/util/utils",["jquery"],function(t){function e(t){var e=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var a=jQuery.trim(n[i]);if(a.substring(0,t.length+1)==t+"="){e=decodeURIComponent(a.substring(t.length+1));break}}return e}function n(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}var i=e("csrftoken");return t.ajaxSetup({beforeSend:function(t,e){n(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",i)}}),{toggleClass:function(t,e,n){return"undefined"!=typeof n?(n?t.addClass(e):t.removeClass(e),n):t.hasClass(e)?(t.removeClass(e),!1):(t.addClass(e),!0)},getParameterByName:function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),i=n.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},bindLoadingButtons:function(e){e.on("click",".loading-button",function(e){var n=t(e.target).closest(".loading-button");return n.data("busy")?(e.stopPropagation(),void e.stopImmediatePropagation()):(n.data("busy",!0),void n.find(".eai").removeAttr("class").addClass("eai eai-loading"))})},restoreLoadingButton:function(t,e){t.data("busy",!1),t.find(".eai").removeAttr("class").addClass("eai "+e)},popup:function(t,e,n,i){e=e||"etalia-popup",n=n||520,i=i||460;var a=Math.round(window.innerWidth/2-n/2),o=Math.round(window.innerHeight/2-i/2),r="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width="+n+",height="+i+",top="+o+",left="+a;return window.open(t,e,r)}}}),function(t){"function"==typeof define&&define.amd?define("jquery.mousewheel",["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var r=e||window.event,l=s.call(arguments,1),u=0,d=0,p=0,h=0,f=0,g=0;if(e=t.event.fix(r),e.type="mousewheel","detail"in r&&(p=-1*r.detail),"wheelDelta"in r&&(p=r.wheelDelta),"wheelDeltaY"in r&&(p=r.wheelDeltaY),"wheelDeltaX"in r&&(d=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(d=-1*p,p=0),u=0===p?d:p,"deltaY"in r&&(p=-1*r.deltaY,u=p),"deltaX"in r&&(d=r.deltaX,0===p&&(u=-1*d)),0!==p||0!==d){if(1===r.deltaMode){var b=t.data(this,"mousewheel-line-height");u*=b,p*=b,d*=b}else if(2===r.deltaMode){var v=t.data(this,"mousewheel-page-height");u*=v,p*=v,d*=v}if(h=Math.max(Math.abs(p),Math.abs(d)),(!o||o>h)&&(o=h,i(r,h)&&(o/=40)),i(r,h)&&(u/=40,d/=40,p/=40),u=Math[u>=1?"floor":"ceil"](u/o),d=Math[d>=1?"floor":"ceil"](d/o),p=Math[p>=1?"floor":"ceil"](p/o),c.settings.normalizeOffset&&this.getBoundingClientRect){var m=this.getBoundingClientRect();f=e.clientX-m.left,g=e.clientY-m.top}return e.deltaX=d,e.deltaY=p,e.deltaFactor=o,e.offsetX=f,e.offsetY=g,e.deltaMode=0,l.unshift(e,u,d,p),a&&clearTimeout(a),a=setTimeout(n,200),(t.event.dispatch||t.event.handle).apply(this,l)}}function n(){o=null}function i(t,e){return c.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120===0}var a,o,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],l="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(t.event.fixHooks)for(var u=r.length;u;)t.event.fixHooks[r[--u]]=t.event.mouseHooks;var c=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var n=l.length;n;)this.addEventListener(l[--n],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",c.getLineHeight(this)),t.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=l.length;n;)this.removeEventListener(l[--n],e,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var n=t(e),i=n["offsetParent"in t.fn?"offsetParent":"parent"]();return i.length||(i=t("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),define("app/ui/layout/flap",["jquery","jquery.mousewheel"],function(t){var e=function(e){e=e||{},this.config=t.extend({debug:!0,flap:null,side:null,button:null,backdrop:null,mobileMaxWidth:992},e),this.$flap=t(this.config.flap),this.$button=t(this.config.button),this.$backdrop=t(this.config.backdrop),this.mobile=null,this.clickHandlersEnabled=!1,this.scrollHandlersEnabled=!1,this.opened=!1,this.scrollTop=0;var n=this;this.log=function(t){n.config.debug&&console.log("[Flap "+this.config.side+"] "+t)},this.buttonClickHandler=function(){n.log("Button click handler"),n.open()},this.backdropClickHandler=function(){n.log("Overlay click handler"),n.close()},this.flapMouseWheelHandler=function(t){return n.log("Window scroll handler"),n.affix(50*t.deltaY),t.preventDefault(),!1},this.backdropMouseWheelHandler=function(t){return t.preventDefault(),!1}};return e.prototype.init=function(){this.log("Flap init");var t=window.innerWidth<this.config.mobileMaxWidth;t!=this.mobile&&(this.close(),this.disableScrollHandlers(),t?this.enableClickHandlers():(this.disableClickHandlers(),this.enableScrollHandlers())),this.mobile=t},e.prototype.enableClickHandlers=function(){this.clickHandlersEnabled||(this.log("enableClickHandlers"),this.$button.on("click",this.buttonClickHandler),this.$backdrop.on("click",this.backdropClickHandler),this.clickHandlersEnabled=!0)},e.prototype.disableClickHandlers=function(){this.clickHandlersEnabled&&(this.log("disableClickHandlers"),this.$button.off("click",this.buttonClickHandler),this.$backdrop.off("click",this.backdropClickHandler),this.clickHandlersEnabled=!1)},e.prototype.enableScrollHandlers=function(){this.scrollHandlersEnabled||(this.log("enableScrollHandlers"),this.$flap.on("mousewheel",this.flapMouseWheelHandler),this.$backdrop.on("mousewheel",this.flapMouseWheelHandler),this.scrollHandlersEnabled=!0)},e.prototype.disableScrollHandlers=function(){this.scrollHandlersEnabled&&(this.log("disableScrollHandlers"),this.$flap.off("mousewheel",this.flapMouseWheelHandler),this.$backdrop.off("mousewheel",this.flapMouseWheelHandler),this.scrollHandlersEnabled=!1)},e.prototype.open=function(){return this.opened?this:(this.opened=!0,t("body").addClass("flap-opened").addClass(this.config.side),this.$flap.css({top:0}),void this.enableScrollHandlers())},e.prototype.close=function(){return this.opened?(t("body").removeClass("flap-opened").removeClass(this.config.side),this.$flap.css({top:0}),this.disableScrollHandlers(),void(this.opened=!1)):this},e.prototype.affix=function(t){var e=parseInt(this.$flap.css("top"))+t,n=window.innerHeight-this.$flap.outerHeight();e>0?e=0:n>e&&(e=n),this.$flap.css({top:e}),this.scrollTop=window.scrollY},e}),define("app/ui/layout/interact",["jquery"],function(t){var e=function(e){this.config=t.extend({debug:!1},e)};return e.prototype.log=function(){return this.config.debug&&console.log("[Interact] "+arguments[0],Array.prototype.splice.call(arguments,1)),this},e.prototype.init=function(){this.log("init()");var t=this,e=0,n=setInterval(function(){return t.log("check ga",e,typeof ga),"function"==typeof ga?(t.initHandlers(),void clearInterval(n)):(e++,void(e>20&&clearInterval(n)))},500);return this},e.prototype.initHandlers=function(){this.log("initHandlers()");var e=this,n=t("body"),i="control";return n.on("etalia.control.search.change",function(t,n){var a={hitType:"event",eventCategory:i,eventAction:"search",eventLabel:n.expression};e.log("ga.send()",a),ga("send",a)}).on("etalia.control.timespan.change",function(t,n){var a={hitType:"event",eventCategory:i,eventAction:"timespan",eventLabel:n.label,eventValue:n.value};e.log("ga.send()",a),ga("send",a)}).on("etalia.control.cluster.change",function(t,n){var a={hitType:"event",eventCategory:i,eventAction:"cluster",eventLabel:n.label,eventValue:n.value};e.log("ga.send()",a),ga("send",a)}).on("etalia.control.pinned.change",function(t,n){var a={hitType:"event",eventCategory:i,eventAction:n.active?"pin":"unpin"};e.log("ga.send()",a),ga("send",a)}).on("etalia.control.filters.change",function(t,n){var a={hitType:"event",eventCategory:i,eventAction:(n.active?"select_":"deselect_")+n.group,eventLabel:n.label,eventValue:n.value};e.log("ga.send()",a),ga("send",a)}).on("etalia.control.filters.more",function(t,n){var a={hitType:"event",eventCategory:i,eventAction:"more_filter",eventLabel:n.group};e.log("ga.send()",a),ga("send",a)}),n.on("etalia.publication.pin",function(t,n){var i={hitType:"event",eventCategory:n.getExtra("source"),eventAction:n.isPinned()?"pin":"unpin",eventLabel:n.getExtra("title"),eventValue:n.getId()};e.log("ga.send()",i),ga("send",i)}).on("etalia.publication.ban",function(t,n){var i={hitType:"event",eventCategory:n.getExtra("source"),eventAction:"ban",eventLabel:n.getExtra("title"),eventValue:n.getId()};e.log("ga.send()",i),ga("send",i)}).on("etalia.publication.add",function(t,n){var i={hitType:"event",eventCategory:n.getExtra("source"),eventAction:"add",eventLabel:n.getExtra("title"),eventValue:n.getId()};e.log("ga.send()",i),ga("send",i)}).on("etalia.publication.trash",function(t,n){var i={hitType:"event",eventCategory:n.getExtra("source"),eventAction:"trash",eventLabel:n.getExtra("title"),eventValue:n.getId()};e.log("ga.send()",i),ga("send",i)}).on("etalia.publication.restore",function(t,n){var i={hitType:"event",eventCategory:n.getExtra("source"),eventAction:"restore",eventLabel:n.getExtra("title"),eventValue:n.getId()};e.log("ga.send()",i),ga("send",i)}).on("etalia.publication.trash-clear",function(){var t={hitType:"event",eventCategory:"library",eventAction:"trash-clear"};e.log("ga.send()",t),ga("send",t)}).on("etalia.publication.share",function(t,n){var i={hitType:"event",eventCategory:n.source,eventAction:"share_"+n.support,eventLabel:n.title,eventValue:n.id};e.log("ga.send()",i),ga("send",i)}),n.on("etalia.detail.similar_timespan.change",function(t,n){var i={hitType:"event",eventCategory:"detail",eventAction:"similar_timespan",eventLabel:n.title,eventValue:n.value};e.log("ga.send()",i),ga("send",i)}),this},(new e).init()}),define("app/ui/layout/invite",["jquery"],function(t){function e(e){e.preventDefault();var i=n.find(".modal-form"),a=n.find(".modal-result");return t.ajax({type:i.attr("method"),url:i.attr("action"),data:i.serialize(),success:function(t){n.find(".form-errors").empty(),i.hide().find("input, textarea").val(""),a.show()},error:function(e){console.log(e.responseText);var i=n.find(".form-errors").empty(),a=JSON.parse(e.responseText);t.each(a,function(t,e){i.prepend('<div class="alert alert-danger" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>'+e+"</div>")})}}),!1}var n;t(function(){n=t("#invite-modal"),t("#open-invite").on("click",function(){t("#profile-dropdown").hide(),n.modal("show")}),n.find("form[data-async]").on("submit",e),n.find(".form-errors").empty(),n.on("hidden.bs.modal",function(){n.find(".modal-form").show(),n.find(".modal-result").hide()})})}),define("app/ui/layout/close-alerts",["jquery"],function(t){t(function(){t("a.close[close-href]").click(function(e){e.preventDefault(),t.post(t(this).attr("close-href"),"",function(){})})})}),define("app/ui/layout",["jquery","app/util/utils","app/ui/layout/flap","app/ui/layout/interact","app/ui/layout/invite","app/ui/layout/close-alerts"],function(t,e,n){var i=function(e){this.config=t.extend({debug:!1,leftFlap:"#nav-flap",leftFlapButton:"#toggle-nav",rightFlap:"#filter-flap",rightFlapButton:"#toggle-filter",backdrop:"#backdrop"},e),this.leftFlap=null,this.rightFlap=null,this.busy=!1;var n=this;this.log=function(t){n.config.debug&&console.log("[Layout] "+t)},this.resizeTimeout=null,this.resizeHandler=function(){n.log("Resize handler"),n.leftFlap&&n.leftFlap.init(),n.rightFlap&&n.rightFlap.init()}};i.prototype.init=function(){var i=t(this.config.leftFlap),a=t(this.config.leftFlapButton),o=t(this.config.rightFlap),r=t(this.config.rightFlapButton),l=!1;if(this.log("Init"),i.length?(this.log("Left flap found"),this.leftFlap=new n({debug:this.config.debug,flap:i,side:"left",button:a,backdrop:this.config.backdrop,mobileMaxWidth:992}),l=!0):a.hide(),o.length?(this.log("Right flap found"),this.rightFlap=new n({debug:this.config.debug,flap:o,side:"right",button:this.config.rightFlapButton,backdrop:this.config.backdrop,mobileMaxWidth:1200}),l=!0):r.hide(),l){var s=this;t(window).on("resize",function(){s.resizeTimeout&&clearTimeout(s.resizeTimeout),s.resizeTimeout=setTimeout(s.resizeHandler,100)}),s.resizeHandler()}var u=t("#toggle-profile"),c=t("#profile-dropdown");c.length&&(u.on("click",function(n){e.toggleClass(t(n.delegateTarget),"active")?c.show():c.hide()}),c.on("click",function(t){t.stopPropagation()}),t(window).on("click",function(e){0==t(e.target).closest("#toggle-profile").length&&(t("#toggle-profile").removeClass("active"),t("#profile-dropdown").hide())}))},i.prototype.setBusy=function(e){t("#busy-content").html(e),this.busy||(this.busy=!0,t("body").addClass("busy"))},i.prototype.setAvailable=function(){this.busy&&(this.busy=!1,t("#busy-content").html(""),t("body").removeClass("busy"))};var a=new i;return a.init(),a}),define("app/ui/control/search",["jquery","app/util/utils"],function(t,e){var n=function(e){this.config=t.extend({debug:!1,element:"#search",toggle:"#toggle-search",close:"#close-search",input:"#search-input"},e),this.$element=t(this.config.element),this.$toggle=this.$element.find(this.config.toggle),this.$close=this.$element.find(this.config.close),this.$input=this.$element.find(this.config.input),this.keyUpTimeout=null};return n.prototype.init=function(){var n=this,i=t("body");return this.$toggle.on("click",function(t){return e.toggleClass($search,"opened"),t.preventDefault(),!1}),this.$close.on("click",function(t){return e.toggleClass($search,"opened"),t.preventDefault(),!1}),this.$input.on("focus",function(e){e.stopPropagation(),t(e.delegateTarget).parents("form").addClass("active")}).on("blur",function(e){e.stopPropagation(),t(e.delegateTarget).parents("form").removeClass("active")}).on("keyup",function(t){n.keyUpTimeout&&clearTimeout(n.keyUpTimeout);var e=t.keyCode||t.which;13==e?i.trigger("etalia.control.search.change",{expression:n.getValue()}):n.keyUpTimeout=setTimeout(function(){i.trigger("etalia.control.search.change",{expression:n.getValue()})},1e3)}),this},n.prototype.setValue=function(t){return this.$input.val(t),this},n.prototype.getValue=function(){return this.$input.val()},n}),define("app/ui/control/timespan",["jquery","app/util/utils"],function(t,e){var n={7:{icon:"W",label:"Week"},30:{icon:"1m",label:"1 month"},60:{icon:"2m",label:"2 months"}},i=function(e){this.config=t.extend({debug:!1,element:"#timespan",toggle:"#toggle-timespan",selection:"#timespan-selection"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.toggle),this.$selection=t(this.config.selection)};return i.getValues=function(){return n},i.getValueIcon=function(t){if(n.hasOwnProperty(t))return n[t].icon;throw"Unexpected timespan value"},i.getValueLabel=function(t){if(n.hasOwnProperty(t))return n[t].label;throw"Unexpected timespan value"},i.prototype.init=function(){var n=this,a=t("body");return this.$toggle.on("click",function(t){return e.toggleClass(n.$element,"opened"),t.preventDefault(),!1}),t(window).on("click",function(e){0==t(e.target).closest(n.config.element).length&&n.$element.removeClass("opened")}),this.$element.on("click",".choices a",function(e){var o=t(e.target).closest("a").data("timespan");return n.setValue(o),n.$toggle.trigger("click"),a.trigger("etalia.control.timespan.change",{value:o,label:i.getValueLabel(o)}),e.preventDefault(),!1}),this},i.prototype.setValue=function(t){return this.$selection.html(i.getValueIcon(t)).data("value",t),this},i.prototype.getValue=function(){return this.$selection.data("value")},i}),define("app/ui/control/cluster",["jquery","app/util/utils"],function(t,e){var n={0:{label:"All"},1:{label:"Purple"},2:{label:"Red"},3:{label:"Orange"},4:{label:"White"}},i=function(e){this.config=t.extend({debug:!1,element:"#cluster",toggle:"#toggle-cluster",selection:"#cluster-selection"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.toggle),this.$selection=t(this.config.selection),this.selected=null};return i.prototype.init=function(){var n=this,i=t("body");return this.$toggle.on("click",function(t){return e.toggleClass(n.$element,"opened"),t.preventDefault(),!1}),t(window).on("click",function(e){0==t(e.target).closest(n.config.element).length&&n.$element.removeClass("opened")}),this.$element.on("click",".choices a",function(e){var a=t(e.target).closest("a").data("cluster");return n.setValue(a),n.$toggle.trigger("click"),i.trigger("etalia.control.timespan.change",{value:a,label:n.getValueColor(a)}),e.preventDefault(),!1}),this},i.prototype.getValueColor=function(t){if(n.hasOwnProperty(t))return n[t].label;throw"Unexpected cluster value"},i.prototype.setValue=function(t){if(t=parseInt(t),this.$selection.removeClass("cluster-"+this.selected),0==t)this.$selection.hide(),this.$toggle.find(".cluster-icon").show();else{if(!(t>0&&4>=t))throw"Unexpected cluster value";this.$selection.css({display:"inline-block"}).addClass("cluster-"+(this.selected-1)),this.$toggle.find(".cluster-icon").hide()}return this.$selection.data("value",t),this.selected=t,this},i.prototype.getValue=function(){return this.$selection.data("value")},i}),define("app/ui/control/pinned",["jquery","app/util/utils"],function(t,e){var n=function(e){this.config=t.extend({debug:!1,element:"#toggle-pinned"},e),this.$element=t(this.config.element)};return n.prototype.init=function(){var n=this,i=t("body");return this.$element.on("click",function(t){var a=e.toggleClass(n.$element,"active");return i.trigger("etalia.control.pinned.change",{active:a}),t.preventDefault(),!1}),this},n.prototype.setValue=function(t){return e.toggleClass(this.$element,"active",t),this},n.prototype.getValue=function(){return this.$element.hasClass("active")},n});var Hogan={};!function(t){function e(t,e,n){var i;return e&&"object"==typeof e&&(void 0!==e[t]?i=e[t]:n&&e.get&&"function"==typeof e.get&&(i=e.get(t))),i}function n(t,e,n,i,a,o){function r(){}function l(){}r.prototype=t,l.prototype=t.subs;var s,u=new r;u.subs=new l,u.subsText={},u.buf="",i=i||{},u.stackSubs=i,u.subsText=o;for(s in e)i[s]||(i[s]=e[s]);for(s in i)u.subs[s]=i[s];a=a||{},u.stackPartials=a;for(s in n)a[s]||(a[s]=n[s]);for(s in a)u.partials[s]=a[s];return u}function i(t){return String(null===t||void 0===t?"":t)}function a(t){return t=i(t),c.test(t)?t.replace(o,"&amp;").replace(r,"&lt;").replace(l,"&gt;").replace(s,"&#39;").replace(u,"&quot;"):t}t.Template=function(t,e,n,i){t=t||{},this.r=t.code||this.r,this.c=n,this.options=i||{},this.text=e||"",this.partials=t.partials||{},this.subs=t.subs||{},this.buf=""},t.Template.prototype={r:function(t,e,n){return""},v:a,t:i,render:function(t,e,n){return this.ri([t],e||{},n)},ri:function(t,e,n){return this.r(t,e,n)},ep:function(t,e){var i=this.partials[t],a=e[i.name];if(i.instance&&i.base==a)return i.instance;if("string"==typeof a){if(!this.c)throw new Error("No compiler available.");a=this.c.compile(a,this.options)}if(!a)return null;if(this.partials[t].base=a,i.subs){e.stackText||(e.stackText={});for(key in i.subs)e.stackText[key]||(e.stackText[key]=void 0!==this.activeSub&&e.stackText[this.activeSub]?e.stackText[this.activeSub]:this.text);a=n(a,i.subs,i.partials,this.stackSubs,this.stackPartials,e.stackText)}return this.partials[t].instance=a,a},rp:function(t,e,n,i){var a=this.ep(t,n);return a?a.ri(e,n,i):""},rs:function(t,e,n){var i=t[t.length-1];if(!d(i))return void n(t,e,this);for(var a=0;a<i.length;a++)t.push(i[a]),n(t,e,this),t.pop()},s:function(t,e,n,i,a,o,r){var l;return d(t)&&0===t.length?!1:("function"==typeof t&&(t=this.ms(t,e,n,i,a,o,r)),l=!!t,!i&&l&&e&&e.push("object"==typeof t?t:e[e.length-1]),l)},d:function(t,n,i,a){var o,r=t.split("."),l=this.f(r[0],n,i,a),s=this.options.modelGet,u=null;if("."===t&&d(n[n.length-2]))l=n[n.length-1];else for(var c=1;c<r.length;c++)o=e(r[c],l,s),void 0!==o?(u=l,l=o):l="";return a&&!l?!1:(a||"function"!=typeof l||(n.push(u),l=this.mv(l,n,i),n.pop()),l)},f:function(t,n,i,a){for(var o=!1,r=null,l=!1,s=this.options.modelGet,u=n.length-1;u>=0;u--)if(r=n[u],o=e(t,r,s),void 0!==o){l=!0;break}return l?(a||"function"!=typeof o||(o=this.mv(o,n,i)),o):a?!1:""},ls:function(t,e,n,a,o){var r=this.options.delimiters;return this.options.delimiters=o,this.b(this.ct(i(t.call(e,a)),e,n)),this.options.delimiters=r,!1},ct:function(t,e,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(t,this.options).render(e,n)},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ms:function(t,e,n,i,a,o,r){var l,s=e[e.length-1],u=t.call(s);return"function"==typeof u?i?!0:(l=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(u,s,n,l.substring(a,o),r)):u},mv:function(t,e,n){var a=e[e.length-1],o=t.call(a);return"function"==typeof o?this.ct(i(o.call(a)),a,n):o},sub:function(t,e,n,i){var a=this.subs[t];a&&(this.activeSub=t,a(e,n,this,i),this.activeSub=!1)}};var o=/&/g,r=/</g,l=/>/g,s=/\'/g,u=/\"/g,c=/[&<>\"\']/,d=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}("undefined"!=typeof exports?exports:Hogan),function(t){function e(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function n(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function i(t,e,n){if(e.charAt(n)!=t.charAt(0))return!1;for(var i=1,a=t.length;a>i;i++)if(e.charAt(n+i)!=t.charAt(i))return!1;return!0}function a(e,n,i,l){var s=[],u=null,c=null,d=null;for(c=i[i.length-1];e.length>0;){if(d=e.shift(),c&&"<"==c.tag&&!(d.tag in k))throw new Error("Illegal content in < super tag.");if(t.tags[d.tag]<=t.tags.$||o(d,l))i.push(d),d.nodes=a(e,d.tag,i,l);else{if("/"==d.tag){if(0===i.length)throw new Error("Closing tag without opener: /"+d.n);if(u=i.pop(),d.n!=u.n&&!r(d.n,u.n,l))throw new Error("Nesting error: "+u.n+" vs. "+d.n);return u.end=d.i,s}"\n"==d.tag&&(d.last=0==e.length||"\n"==e[0].tag)}s.push(d)}if(i.length>0)throw new Error("missing closing tag: "+i.pop().n);return s}function o(t,e){for(var n=0,i=e.length;i>n;n++)if(e[n].o==t.n)return t.tag="#",!0}function r(t,e,n){for(var i=0,a=n.length;a>i;i++)if(n[i].c==t&&n[i].o==e)return!0}function l(t){var e=[];for(var n in t)e.push('"'+u(n)+'": function(c,p,t,i) {'+t[n]+"}");return"{ "+e.join(",")+" }"}function s(t){var e=[];for(var n in t.partials)e.push('"'+u(n)+'":{name:"'+u(t.partials[n].name)+'", '+s(t.partials[n])+"}");return"partials: {"+e.join(",")+"}, subs: "+l(t.subs)}function u(t){return t.replace(m,"\\\\").replace(g,'\\"').replace(b,"\\n").replace(v,"\\r").replace(y,"\\u2028").replace(w,"\\u2029")}function c(t){return~t.indexOf(".")?"d":"f"}function d(t,e){var n="<"+(e.prefix||""),i=n+t.n+x++;return e.partials[i]={name:t.n,partials:{}},e.code+='t.b(t.rp("'+u(i)+'",c,p,"'+(t.indent||"")+'"));',i}function p(t,e){e.code+="t.b(t.t(t."+c(t.n)+'("'+u(t.n)+'",c,p,0)));'}function h(t){return"t.b("+t+");"}var f=/\S/,g=/\"/g,b=/\n/g,v=/\r/g,m=/\\/g,y=/\u2028/,w=/\u2029/;t.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},t.scan=function(a,o){function r(){m.length>0&&(y.push({tag:"_t",text:new String(m)}),m="")}function l(){for(var e=!0,n=x;n<y.length;n++)if(e=t.tags[y[n].tag]<t.tags._v||"_t"==y[n].tag&&null===y[n].text.match(f),!e)return!1;return e}function s(t,e){if(r(),t&&l())for(var n,i=x;i<y.length;i++)y[i].text&&((n=y[i+1])&&">"==n.tag&&(n.indent=y[i].text.toString()),y.splice(i,1));else e||y.push({tag:"\n"});w=!1,x=y.length}function u(t,e){var i="="+$,a=t.indexOf(i,e),o=n(t.substring(t.indexOf("=",e)+1,a)).split(" ");return C=o[0],$=o[o.length-1],a+i.length-1}var c=a.length,d=0,p=1,h=2,g=d,b=null,v=null,m="",y=[],w=!1,k=0,x=0,C="{{",$="}}";for(o&&(o=o.split(" "),C=o[0],$=o[1]),k=0;c>k;k++)g==d?i(C,a,k)?(--k,r(),g=p):"\n"==a.charAt(k)?s(w):m+=a.charAt(k):g==p?(k+=C.length-1,v=t.tags[a.charAt(k+1)],b=v?a.charAt(k+1):"_v","="==b?(k=u(a,k),g=d):(v&&k++,g=h),w=k):i($,a,k)?(y.push({tag:b,n:n(m),otag:C,ctag:$,i:"/"==b?w-C.length:k+$.length}),m="",k+=$.length-1,g=d,"{"==b&&("}}"==$?k++:e(y[y.length-1]))):m+=a.charAt(k);return s(w,!0),y};var k={_t:!0,"\n":!0,$:!0,"/":!0};t.stringify=function(e,n,i){return"{code: function (c,p,i) { "+t.wrapMain(e.code)+" },"+s(e)+"}"};var x=0;t.generate=function(e,n,i){x=0;var a={code:"",subs:{},partials:{}};return t.walk(e,a),i.asString?this.stringify(a,n,i):this.makeTemplate(a,n,i)},t.wrapMain=function(t){return'var t=this;t.b(i=i||"");'+t+"return t.fl();"},t.template=t.Template,t.makeTemplate=function(t,e,n){var i=this.makePartials(t);return i.code=new Function("c","p","i",this.wrapMain(t.code)),new this.template(i,e,this,n)},t.makePartials=function(t){var e,n={subs:{},partials:t.partials,name:t.name};for(e in n.partials)n.partials[e]=this.makePartials(n.partials[e]);for(e in t.subs)n.subs[e]=new Function("c","p","t","i",t.subs[e]);return n},t.codegen={"#":function(e,n){n.code+="if(t.s(t."+c(e.n)+'("'+u(e.n)+'",c,p,1),c,p,0,'+e.i+","+e.end+',"'+e.otag+" "+e.ctag+'")){t.rs(c,p,function(c,p,t){',t.walk(e.nodes,n),n.code+="});c.pop();}"},"^":function(e,n){n.code+="if(!t.s(t."+c(e.n)+'("'+u(e.n)+'",c,p,1),c,p,1,0,0,"")){',t.walk(e.nodes,n),n.code+="};"},">":d,"<":function(e,n){var i={partials:{},code:"",subs:{},inPartial:!0};t.walk(e.nodes,i);var a=n.partials[d(e,n)];a.subs=i.subs,a.partials=i.partials},$:function(e,n){var i={subs:{},code:"",partials:n.partials,prefix:e.n};t.walk(e.nodes,i),n.subs[e.n]=i.code,n.inPartial||(n.code+='t.sub("'+u(e.n)+'",c,p,i);')},"\n":function(t,e){e.code+=h('"\\n"'+(t.last?"":" + i"))},_v:function(t,e){e.code+="t.b(t.v(t."+c(t.n)+'("'+u(t.n)+'",c,p,0)));'},_t:function(t,e){e.code+=h('"'+u(t.text)+'"')},"{":p,"&":p},t.walk=function(e,n){for(var i,a=0,o=e.length;o>a;a++)i=t.codegen[e[a].tag],i&&i(e[a],n);return n},t.parse=function(t,e,n){return n=n||{},a(t,"",[],n.sectionTags||[])},t.cache={},t.cacheKey=function(t,e){return[t,!!e.asString,!!e.disableLambda,e.delimiters,!!e.modelGet].join("||")},t.compile=function(e,n){n=n||{};var i=t.cacheKey(e,n),a=this.cache[i];if(a){var o=a.partials;for(var r in o)delete o[r].instance;return a}return a=this.generate(this.parse(this.scan(e,n.delimiters),e,n),e,n),this.cache[i]=a}}("undefined"!=typeof exports?exports:Hogan),"function"==typeof define&&define.amd&&define("hogan",Hogan),define("app/util/templates",["require","hogan"],function(t){var e=t("hogan"),n={};return n.filters=new e.Template({code:function(t,e,n){var i=this;return i.b(n=n||""),i.s(i.f("groups",t,e,1),t,e,0,11,771,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b('<div class="filter-group" data-id="'),i.b(i.v(i.f("id",t,e,0))),i.b('">'),i.b("\n"+n),i.b('    <a href="javascript: void(0)" class="filter-toggle">'),i.b("\n"+n),i.b("        "),i.b(i.v(i.f("id",t,e,0))),i.b(' <span class="eai eai-down"></span>'),i.b("\n"+n),i.b("    </a>"),i.b("\n"+n),i.b('    <div class="filter-filters collapse">'),i.b("\n"+n),i.b("        <ul>"),i.b("\n"+n),i.s(i.f("entries",t,e,1),t,e,0,251,621,"{{ }}")&&(i.rs(t,e,function(t,e,i){i.b("            <li>"),i.b("\n"+n),i.b('                <a href="javascript: void(0)" data-id="'),i.b(i.v(i.f("pk",t,e,0))),i.b('" title="'),i.b(i.v(i.f("name",t,e,0))),i.b('"'),i.b("\n"+n),i.b("                    "),i.s(i.f("is_checked",t,e,1),t,e,0,384,400,"{{ }}")&&(i.rs(t,e,function(t,e,n){n.b(' class="active" ')}),t.pop()),i.b(">"),i.b("\n"+n),i.b("                    "),i.s(i.f("count",t,e,1),t,e,0,447,492,"{{ }}")&&(i.rs(t,e,function(t,e,n){n.b('<span class="filter-count">('),n.b(n.v(n.f("count",t,e,0))),n.b(")</span>")}),t.pop()),i.b("\n"+n),i.b('                    <span class="filter-checkbox"></span> '),i.b(i.v(i.f("name",t,e,0))),i.b("\n"+n),i.b("                </a>"),i.b("\n"+n),i.b("            </li>"),i.b("\n"+n)}),t.pop()),i.b("        </ul>"),i.b("\n"+n),i.b('        <a href="javascript: void(0)" class="filter-more">'),i.b("\n"+n),i.b("            More filters&hellip;"),i.b("\n"+n),i.b("        </a>"),i.b("\n"+n),i.b("    </div>"),i.b("\n"+n),i.b("</div>"),i.b("\n"+n)}),t.pop()),i.fl()},partials:{},subs:{}}),n}),define("app/ui/control/filters",["jquery","app/util/templates","app/util/utils"],function(t,e,n){var i={id:[],opened:[],count:[]};i.has=function(t){return 0<=this.id.indexOf(t)},i.add=function(t,e,n){this.has(t)&&this.set(t,e,n),this.id.push(t),this.opened.push(e),this.count.push(n)},i.set=function(t,e,n){this.has(t)||this.add(t,e,n);var i=this.id.indexOf(t);this.opened[i]=e,this.count[i]=n},i.get=function(t){if(!this.has(t))throw'Undefined group "'+t+'"';var e=this.id.indexOf(t);return{opened:this.opened[e],count:this.count[e]}},i.setOpened=function(t,e){if(!this.has(t))throw'Undefined group "'+t+'"';var n=this.id.indexOf(t);this.opened[n]=e},i.getOpened=function(t){if(!this.has(t))throw'Undefined group "'+t+'"';return this.opened[this.id.indexOf(t)]},i.setCount=function(t,e){if(!this.has(t))throw'Undefined group "'+t+'"';var n=this.id.indexOf(t);this.count[n]=e},i.getCount=function(t){if(!this.has(t))throw'Undefined group "'+t+'"';return this.count[this.id.indexOf(t)]};var a=function(e){this.config=t.extend({debug:!1,element:"#filter-flap"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.selection),this.$selection=t(this.config.selection),this.selected=null};return a.prototype.init=function(){var e=this,a=t("body");return this.$element.find(".filter-group").each(function(n,a){var o=t(a),r=o.find(".filter-filters ul a:visible").length;i.add(o.data("id"),o.hasClass("active"),r),e.applyUserSelection(o)}),this.$element.on("click",".filter-toggle",function(e){var a=t(e.target).closest(".filter-group"),o=a.data("id");n.toggleClass(a,"active")?(a.find(".filter-filters").collapse("show"),i.setOpened(o,!0)):(a.find(".filter-filters").collapse("hide"),i.setOpened(o,!1))}).on("click",".filter-group ul a",function(e){var i=t(e.target).closest("a"),o=i.closest(".filter-group"),r=n.toggleClass(i,"active");a.trigger("etalia.control.filters.change",{value:i.data("id"),label:i.attr("title"),group:o.data("id"),active:r})}).on("click",".filter-more",function(n){var o=t(n.target).closest(".filter-group"),r=o.data("id"),l=i.getCount(r);i.setCount(r,l+10),e.applyUserSelection(o),a.trigger("etalia.control.filters.more",{group:o.data("id"),count:l})}),this},a.prototype.applyUserSelection=function(t){var e=t.find("ul li"),n=i.get(t.data("id"));return n.opened?t.addClass("active").find(".filter-filters").addClass("in"):t.removeClass("active").find(".filter-filters").removeClass("in"),n.count>=e.length?(e.show(),t.find(".filter-more").hide()):(e.filter(":lt("+n.count+")").show(),e.filter(":gt("+(n.count-1)+")").hide(),t.find(".filter-more").show()),this},a.prototype.render=function(n){var i=this;return this.$element.html(e.filters.render({groups:n})).find(".filter-group").each(function(e,n){i.applyUserSelection(t(n))}),this},a.prototype.setValue=function(){throw"Not implemented"},a.prototype.getValue=function(){var e=[];return this.$element.find(".filter-group").each(function(n,i){var a=t(i),o=[];a.find("li a.active").each(function(){o.push(t(this).data("id"))}),o.length&&e.push({id:a.data("id"),pk:o})}),e},a}),define("app/ui/controls",["jquery","app/ui/control/search","app/ui/control/timespan","app/ui/control/cluster","app/ui/control/pinned","app/ui/control/filters"],function(t,e,n,i,a,o){var r={search:(new e).init(),timespan:(new n).init(),cluster:(new i).init(),pinned:(new a).init(),filters:(new o).init()};return r.getStates=function(){return{time_span:this.timespan.getValue(),cluster:this.cluster.getValue(),pin:this.pinned.getValue(),search_query:this.search.getValue(),filters:this.filters.getValue()}},r.setStates=function(t){return t.hasOwnProperty("cluster")&&this.cluster.setValue(t.cluster||0),
t.hasOwnProperty("time_span")&&this.timespan.setValue(t.time_span),t.hasOwnProperty("pin")&&this.pinned.setValue(t.pin),t.hasOwnProperty("search_query")&&this.search.setValue(t.search_query),t.hasOwnProperty("filters")&&this.filters.render(t.filters),this},r}),define("app/ui/api",["jquery"],function(t){var e,n={debug:!1};n.log=function(){this.debug&&console.log("[API] "+arguments[0],Array.prototype.splice.call(arguments,1))};var i=function(t){this.id=t.hasOwnProperty("id")?t.id:null,this.states=t.hasOwnProperty("state")?t.state:[],this.counts=t.hasOwnProperty("counter")?t.counter:[],this.extra=t.hasOwnProperty("extra")?t.extra:{},this._hasState=function(t){return this.states.hasOwnProperty(t)},this._getState=function(t){if(this._hasState(t))return this.states[t];throw'Undefined state "'+t+'"'},this._hasCount=function(t){return this.counts.hasOwnProperty(t)},this._getCount=function(t){if(this._hasCount(t))return this.counts[t];throw'Undefined count "'+t+'"'}};return i.prototype.getId=function(){return this.id},i.prototype.isPinned=function(){return this._getState("is_pinned")},i.prototype.isBanned=function(){return this._getState("is_banned")},i.prototype.isTrashed=function(){return this._getState("is_trashed")},i.prototype.isAdded=function(){return this._getState("is_added")},i.prototype.getPinCount=function(){return this._getCount("pin")},i.prototype.getBanCount=function(){return this._getCount("ban")},i.prototype.getTrashCount=function(){return this._getCount("trash")},i.prototype.getLibraryCount=function(){return this._getCount("library")},i.prototype.getExtra=function(t){if(t){if(this.extra.hasOwnProperty(t))return this.extra[t];throw'Undefined extra "'+t+'"'}return this.extra},n.pin=function(a,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/pin",data:{id:a,source:window.location.pathname}}).done(function(t){t.id=a,t.extra=o,n.log("pin success",t),e.trigger("etalia.publication.pin",new i(t))}).fail(function(t,e,i){n._failureCallback(o),n.log("pin failure",t,e,i)}),this},n.ban=function(a,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/ban",data:{id:a,source:window.location.pathname}}).done(function(t){t.id=a,t.extra=o,n.log("ban success",t),e.trigger("etalia.publication.ban",new i(t))}).fail(function(t,e,i){n._failureCallback(o),n.log("ban failure",t,e,i)}),this},n.add=function(a,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/add",data:{id:a}}).done(function(t){return t.id=a,t.extra=o,t.hasOwnProperty("success")&&!t.success?(n._failureCallback(o),void n.log("add failure",t)):(n.log("add success",t),void e.trigger("etalia.publication.add",new i(t)))}).fail(function(t,e,i){n._failureCallback(o),n.log("add failure",t,e,i)}),this},n.trash=function(a,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/trash",data:{id:a}}).done(function(t){return t.id=a,t.extra=o,t.hasOwnProperty("success")&&!t.success?(n._failureCallback(o),void n.log("trash failure",t)):(n.log("trash success",t),void e.trigger("etalia.publication.trash",new i(t)))}).fail(function(t,e,i){n._failureCallback(o),n.log("trash failure",t,e,i)}),this},n.restore=function(a,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/restore",data:{id:a}}).done(function(t){return t.id=a,t.extra=o,t.hasOwnProperty("success")&&!t.success?(n._failureCallback(o),void n.log("restore failure",t)):(n.log("restore success",t),void e.trigger("etalia.publication.restore",new i(t)))}).fail(function(t,e,i){n._failureCallback(o),n.log("restore failure",t,e,i)}),this},n.clearTrash=function(a){return a=a||{},t.ajax({type:"POST",url:"/user/library/trash/empty"}).done(function(t){t.extra=a,n.log("clear trash success",t),e.trigger("etalia.publication.trash-clear",new i(t))}).fail(function(t,e,i){n._failureCallback(a),n.log("clear trash failure",t,e,i)}),this},n._failureCallback=function(t){t.hasOwnProperty("failureCallback")&&t.failureCallback()},t(function(){e=t("body")}),n}),define("app/ui/list",["jquery","app/ui/api","app/util/utils","altmetric"],function(t,e,n){var i=function(e){this.config=t.extend({debug:!1,element:"#list",container:".thumb-list"},e),this.$element=t(this.config.element),this.loadXhr=null};return i.prototype.log=function(){return this.config.debug&&console.log("[List] "+arguments[0],Array.prototype.splice.call(arguments,1)),this},i.prototype.init=function(){function i(t){return{source:"thumb",title:t.data("paper-title")}}return this.log("init",this.$element),n.bindLoadingButtons(this.$element),this.$element.on("click",".thumb-pin",function(n){var a=t(n.target).closest(".thumb");return e.pin(a.data("paper-id"),i(a)),n.preventDefault(),!1}).on("click",".thumb-ban",function(n){var a=t(n.target).closest(".thumb");return e.ban(a.data("paper-id"),i(a)),n.preventDefault(),!1}).on("click",".thumb-library-add",function(a){var o=t(a.target).closest(".thumb-library-add"),r=t(a.target).closest(".thumb"),l=i(r);return l.failureCallback=function(){n.restoreLoadingButton(o,"eai-library-add")},e.add(r.data("paper-id"),l),a.preventDefault(),!1}).on("click",".thumb-library-trash",function(a){var o=t(a.target).closest(".thumb-library-trash"),r=t(a.target).closest(".thumb"),l=i(r);return l.failureCallback=function(){n.restoreLoadingButton(o,"eai-library-trash")},e.trash(r.data("paper-id"),l),a.preventDefault(),!1}).on("click",".thumb-library-restore",function(a){var o=t(a.target).closest(".thumb-library-restore"),r=t(a.target).closest(".thumb"),l=i(r);return l.failureCallback=function(){n.restoreLoadingButton(o,"eai-library-add")},e.restore(r.data("paper-id"),l),a.preventDefault(),!1}),this},i.prototype.load=function(e){e=e||{},this.loadXhr&&this.loadXhr.abort();var n=this,i=t("body");return n.$element.find(n.config.container).empty().append(t("#busy-modal .sk-cube-grid").clone()),this.loadXhr=t.ajax({method:"GET",url:n.$element.data("load-url"),data:{data:JSON.stringify(e)},dataType:"xml"}).done(function(e){var a={},o=t(e).find("data");o.length&&(o=JSON.parse(o.text()),o.hasOwnProperty("number_of_papers")&&n.$element.find(".list-title span").html(o.number_of_papers),a.controlsStates=o);var r=t(e).find("thumb-list");r.length&&n.$element.find(n.config.container).html(t(r.text())),_altmetric_embed_init(),i.trigger("etalia.list.load",a)}).fail(function(t,e,i){n.log("Load failure",t,e,i)}),this.log("load",n.$element.data("load-url")),this},i}),define("app/util/sticky",["jquery"],function(t){var e=function(e){function n(t){r.debug&&console.log("[Sticky] "+t)}function i(){if(h=s.scrollTop(),f=0,n("scrollHandler : "+f+" / "+h),null!==c&&g){f=parseInt(l.css("top"));var t=c-h;f+=t,0>t?(f+d<h+p-r.bottom&&(f=h+p-d-r.bottom),n("scrolling down : "+f)):(f>h+r.top&&(f=h+r.top),n("scrolling up : "+f))}else f<h+r.top&&(f=h+r.top),n("fixed : "+f);c=h,l.css({top:f})}function a(){d=l.outerHeight(),p=s.innerHeight(),n("resizeTimeoutHandler : "+d+" / "+p),g=d>p}function o(){u&&clearTimeout(u),u=setTimeout(a,150)}var r=t.extend({debug:!0,element:null,parent:null,top:0,bottom:0},e),l=t(r.element),s=t(r.parent?r.parent:window),u=null,c=null,d=0,p=0,h=0,f=0,g=!1;this.addHandlers=function(){s.on("scroll",i),t(window).on("resize",o),a(),i()},this.removeHandlers=function(){s.off("scroll",i),t(window).off("resize",o),l.css({position:"absolute",top:"0px"}),c=null},this.enabled=!1};return e.prototype.enable=function(){this.enabled||(this.addHandlers(),this.enabled=!0)},e.prototype.disable=function(){this.enabled&&(this.removeHandlers(),this.enabled=!1)},e}),define("app/ui/paper",["jquery","app/ui/api","app/util/utils","app/ui/controls","app/ui/control/timespan","app/ui/list","app/util/sticky"],function(t,e,n,i,a,o,r){function l(t,e){e?(t.removeClass("detail-library-add detail-library-restore").addClass("detail-library-trash"),n.restoreLoadingButton(t,"eai-library-trash")):(t.removeClass("detail-library-trash").addClass("detail-library-restore"),n.restoreLoadingButton(t,"eai-library-add"))}var s=function(e){this.config=t.extend({debug:!1,element:"#detail",document:".document",actions:".inner > .actions",neighbors:".neighbors-thumbs"},e),this.$element=t(this.config.element),this.$document=this.$element.find(this.config.document),this.id=null,this.$actions=null,this.actions=null,this.neighbors=null};return s.prototype.log=function(){this.config.debug&&console.log("[Paper] "+arguments[0],Array.prototype.splice.call(arguments,1))},s.prototype.getId=function(){return this.id},s.prototype.init=function(){function i(){return{source:"detail",title:o.$actions.data("paper-title")}}this.log("init");var o=this,r=t("body");return r.on("etalia.publication.pin",function(t,e){o.id==e.getId()&&o.$actions.find(".detail-pin").toggleClass("active",e.isPinned())}).on("etalia.publication.add",function(t,e){if(o.id==e.getId()&&e.isAdded()){var n=o.$actions.find(".detail-library-add");l(n,!0)}}).on("etalia.publication.trash",function(t,e){if(o.id==e.getId()&&e.isTrashed()){var n=o.$actions.find(".detail-library-trash");l(n,!1)}}).on("etalia.publication.restore",function(t,e){if(o.id==e.getId()&&e.isAdded()){var n=o.$actions.find(".detail-library-restore");l(n,!0)}}),this.$document.on("click",".neighbors-timespan-selector a",function(e){var n=t(e.target).closest("a"),i=n.data("value");return n.closest(".neighbors-timespan-selector").find("li").removeClass("active"),n.closest("li").addClass("active"),o.neighbors&&o.neighbors.load({time_span:i}),r.trigger("etalia.detail.similar_timespan.change",{value:i,label:a.getValueLabel(i)}),e.preventDefault(),!1}).on("click",".detail-questions",function(t){var e=o.$document.find(".questions-thumbs").position().top-15;return o.$document.scrollTop(e),t.preventDefault(),!1}).on("click",".detail-neighbors",function(t){var e=o.$document.find(".neighbors-thumbs").position().top-15;return o.$document.scrollTop(e),t.preventDefault(),!1}).on("click",".detail-pin",function(t){if(!o.id)throw"Undefined paper id";return e.pin(o.id,i()),t.preventDefault(),!1}).on("click",".detail-ban",function(t){if(!o.id)throw"Undefined paper id";return e.ban(o.id,i()),t.preventDefault(),!1}).on("click",".detail-library-add:visible",function(a){if(!o.id)throw"Undefined paper id";var r=t(a.target).closest(".detail-library-add"),l=i();return l.failureCallback=function(){n.restoreLoadingButton(r,"eai-library-add")},e.add(o.id,l),a.preventDefault(),!1}).on("click",".detail-library-trash:visible",function(a){if(!o.id)throw"Undefined paper id";var r=t(a.target).closest(".detail-library-trash"),l=i();return l.failureCallback=function(){n.restoreLoadingButton(r,"eai-library-trash")},e.trash(o.id,l),a.preventDefault(),!1}).on("click",".detail-library-restore:visible",function(a){if(!o.id)throw"Undefined paper id";var r=t(a.target).closest(".detail-library-restore"),l=i();return l.failureCallback=function(){n.restoreLoadingButton(r,"eai-library-add")},e.restore(o.id,l),a.preventDefault(),!1}).on("click",".detail-twitter:visible",function(e){var a=t("#detail-actions"),l="https://twitter.com/intent/tweet/?text="+a.data("paper-title")+"&url="+a.data("paper-url")+"&via=etalia";n.popup(l,"share-popup");var s=i();return s.id=o.id,s.support="twitter",r.trigger("etalia.publication.share",s),e.preventDefault(),!1}).on("click",".detail-google-plus:visible",function(e){var a=t("#detail-actions"),l="https://plus.google.com/share?url="+a.data("paper-url");n.popup(l,"share-popup");var s=i();return s.id=o.id,s.support="google-plus",r.trigger("etalia.publication.share",s),e.preventDefault(),!1}).on("click",".detail-mail:visible",function(){var t=i();t.id=o.id,t.support="email",r.trigger("etalia.publication.share",t)}),this},s.prototype.update=function(){this.log("update"),this.$actions=this.$element.find(this.config.actions),n.bindLoadingButtons(this.$actions),this.id=parseInt(this.$actions.data("paper-id")),this.actions=new r({debug:this.config.debug,element:this.$actions,parent:this.$document,top:20,bottom:20}),this.actions.enable();var e=t(".neighbors-timespan-selector li.active a").data("value")||30;return this.neighbors=new o({debug:this.config.debug,element:this.config.element+" "+this.config.neighbors}).init().load({time_span:e}),this},s.prototype.clear=function(){this.actions&&(this.actions.disable(),this.actions=null),this.$actions&&(this.$actions=null),this.neighbors=null,this.id&&(this.id=null)},s}),define("app/ui/detail",["jquery","app/ui/paper"],function(t,e){var n=function(n){this.config=t.extend({debug:!1,element:"#detail",document:".document",actions:".inner > .actions"},n),this.$element=t(this.config.element),this.$document=this.$element.find(this.config.document),this.$nextButton=t("#detail-next"),this.$prevButton=t("#detail-prev"),this.loaded=!1,this.loadXhr=null,this.paper=new e(n).init();var i=this;t("#detail-close, #backdrop").on("click",function(){i.close()})};return n.prototype.log=function(){return this.config.debug&&console.log("[Detail] "+arguments[0],Array.prototype.splice.call(arguments,1)),this},n.prototype.init=function(){var e=this;return t("body").on("etalia.publication.ban",function(t,n){e.paper.getId()==n.getId()&&n.isBanned()&&e.close()}).on("etalia.detail.loaded",function(){e.paper.update()}),this},n.prototype.load=function(e){var n=this,i=t("body"),a=e.prev(),o=e.next();if(n.clear(),i.addClass("detail-opened").trigger("etalia.detail.loading"),a.length){var r=a.find(".title").text();n.$prevButton.show().attr("title",r),n.$prevButton.find("> span").html(r),n.$prevButton.find("> button").on("click",function(){n.load(a)})}if(o.length){var l=o.find(".title").text();n.$nextButton.show().attr("title",l),n.$nextButton.find("> span").html(l),n.$nextButton.find("> button").on("click",function(){n.load(o)})}return this.loadXhr=t.ajax({method:"GET",url:e.find(".title a").attr("href")}).done(function(t){n.$document.find(".inner").html(t),n.$document.show(),n.loaded=!0,n.loadXhr=null,i.trigger("etalia.detail.loaded")}).fail(function(t,e,i){n.log("Load failure",t,e,i)}),this},n.prototype.clear=function(){this.loaded=!1,this.loadXhr&&(this.loadXhr.abort(),this.loadXhr=null),this.paper.clear(),this.$document.hide().find(".inner").html("");var e=t(".detail-nav");return e.hide().removeAttr("title"),e.find("> button").off("click"),e.find("> span").empty(),this},n.prototype.close=function(){return this.clear(),t("body").removeClass("detail-opened"),this},n}),define("endless",["jquery","app/util/utils"],function(t,e){t.fn.endlessPaginate=function(n){var i={containerSelector:".endless_container",loadingSelector:".endless_loading",moreSelector:"a.endless_more",pageSelector:".endless_page_template",pagesSelector:"a.endless_page_link",onClick:function(){},onCompleted:function(){},paginateOnScroll:!1,paginateOnScrollMargin:1,paginateOnScrollChunkSize:0},a=t.extend(i,n),o=function(t){return{key:t.attr("rel").split(" ")[0],url:t.attr("href")}};return this.each(function(){var n=t(this),i=1;if(n.on("click",a.moreSelector,function(){var n=t(this),r=n.get(0),l=n.closest(a.containerSelector),s=l.find(a.loadingSelector);if(s.is(":visible"))return!1;n.hide(),s.show();var u=o(n);if(a.onClick.apply(r,[u])!==!1){var c={querystring_key:u.key,data:u.extraData,page:e.getParameterByName("page",u.url)};t.get(u.urlOrigin,c,function(t){l.before(t),l.remove(),i+=1,a.onCompleted.apply(r,[u,t.trim()])})}return!1}),a.paginateOnScroll){var r=t(window),l=t(document);r.scroll(function(){if(l.height()-r.height()-r.scrollTop()<=a.paginateOnScrollMargin){var t=a.paginateOnScrollChunkSize;(!t||i%t)&&n.find(a.moreSelector).click()}})}n.on("click",a.pagesSelector,function(){var e=t(this),n=e.get(0),i=o(e);if(a.onClick.apply(n,[i])!==!1){var r=e.closest(a.pageSelector),l="querystring_key="+i.key;r.load(i.url,l,function(t){a.onCompleted.apply(n,[i,t.trim()])})}return!1})})},t.endlessPaginate=function(e){return t("body").endlessPaginate(e)}}),define("app/feed/default",["jquery","app/ui/layout","app/ui/controls","app/ui/list","app/ui/detail","endless","bootstrap"],function(t,e,n,i,a){var o,r=new i,l=new a;t(function(){o=t("body"),r.init(),l.init(),o.on("etalia.control.search.change etalia.control.timespan.change etalia.control.cluster.change etalia.control.pinned.change etalia.control.filters.change",function(){r.load(n.getStates())}).on("etalia.list.load",function(t,e){e.hasOwnProperty("controlsStates")&&n.setStates(e.controlsStates)}).on("etalia.publication.pin",function(e,n){t(".thumb[data-paper-id="+n.getId()+"]").find(".thumb-pin").toggleClass("active",n.isPinned())}).on("etalia.publication.ban",function(e,n){n.isBanned()&&t(".thumb[data-paper-id="+n.getId()+"]").remove()}).on("etalia.publication.trash",function(e,n){n.isTrashed()&&t(".thumb[data-paper-id="+n.getId()+"]").remove()}).on("etalia.detail.loading",function(){e.setBusy()}).on("etalia.detail.loaded",function(){e.setAvailable()}),t("#list").on("click",".thumb .title a",function(e){return l.load(t(e.target).closest(".thumb")),e.preventDefault(),!1}),t.endlessPaginate({paginateOnScroll:!0,paginateOnScrollMargin:90,onClick:function(t){t.extraData=JSON.stringify(n.getStates()),t.urlOrigin=window.location.href},onCompleted:function(){_altmetric_embed_init()}})})});