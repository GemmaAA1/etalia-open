{% extends 'layout.html' %}


{% load staticfiles %}


{% block title %}{{ block.super }} - Thread{% endblock %}


{% block content %}
{% spaceless %}
    <div style="padding-top: 100px"></div>
    <h4 class="title">
        title: {{ thread.title }}
    </h4>
    <h4>
        type: {{ thread.type }}
    </h4>
    <h4>
        owner: {{ thread.owner }}
    </h4>
    <h4>
        content: {{ thread.content }}
    </h4>
    <a href="{% url 'threads:update_thread' thread.id %}">edit Thread</a>
    <h4>
        privacy: {{ thread.privacy }}
    </h4>
    <h4>
        # posts: {{ nb_posts }}
    </h4>
    <h4>
        # members: {{ nb_members }}
    </h4>
    <h4>
        has_joined: {{ state.is_joined }}
    </h4>
    <h4>
        following: {{ following }}
    </h4>

    Pin: {{ state.is_pinned }}
    <form role="form" method="POST" action="{% url 'threads:state' %}">
        {% csrf_token %}
        <input type="text" name="action" value="pin" hidden>
        <input type="text" name="thread" value="{{ thread.id }}" hidden>
        <button id="signup" type="submit" class="btn btn-primary">Pin</button>
    </form>
    Ban: {{ state.is_banned }}
    <form role="form" method="POST" action="{% url 'threads:state' %}">
        {% csrf_token %}
        <input type="text" name="action" value="ban" hidden>
        <input type="text" name="thread" value="{{ thread.id }}" hidden>
        <button id="signup" type="submit" class="btn btn-primary">Ban</button>
    </form>

    {% if state.is_joined %}
        <h4>
            members:
            {% for member in members %}
                {{ member }}
                {% if member in following %}
                    (followed)
                {% elif %}
                    <a href="{% url 'users:follow'  %}">(follow)</a>
                {% endif %}

            {% endfor %}
        </h4>
        <div>
            {% for member in members %}
                <img style="height: 50px;" src="{{ member.photo.name }}"/>
            {% endfor %}
        </div>

        <h4>
            posts:
        </h4>
        {% if posts %}
            {% for post in posts %}
                <div style="padding: 5px 0 5px 0;">
                    {{ post.created }}
                    {{ post.author }}
                    {{ post.content }}
                    {% if post.author == user %}
                        <a href="{% url 'threads:edit_post' post.id %}">Edit </a>
                        <a href="{% url 'threads:delete_post' post.id %}">Delete</a>
                    {% endif %}
                    <div style="padding-left: 20px">comment: <br>
                    {% for comment in post.comments.all %}
                        <div>
                        {{ comment.created }} {{ comment.author }} {{ comment.content }}
                        {% if comment.author == user %}
                            <a href="{% url 'threads:edit_comment' comment.id %}">Edit </a>
                            <a href="{% url 'threads:delete_comment' comment.id %}">Delete</a>
                        </div>
                    {% endif %}
                    {% endfor %}
                    <a href="{% url 'threads:new_comment' post.id %}">Add comment</a>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            No posts yet
        {% endif %}

        <div style="padding-top: 10px;">
            <a href="{% url 'threads:new_post' thread.id%}">New Post</a>
        </div>
        <h4>
            <form role="form" method="POST" action="{% url 'threads:state' %}">
                {% csrf_token %}
                <input type="text" name="action" value="leave" hidden>
                <input type="text" name="thread" value="{{ thread.id }}" hidden>
                <button id="signup" type="submit" class="btn btn-primary">Leave</button>
            </form>
        </h4>

    {% else %}
        <h4>
            members: {{ members }}
        </h4>
        <h4>
            <form role="form" method="POST" action="{% url 'threads:state' %}">
                {% csrf_token %}
                <input type="text" name="action" value="join" hidden>
                <input type="text" name="thread" value="{{ thread.id }}" hidden>
                <button type="submit" class="btn btn-primary">Join</button>
            </form>
        </h4>
    {% endif %}

{% endspaceless %}
{% endblock content %}