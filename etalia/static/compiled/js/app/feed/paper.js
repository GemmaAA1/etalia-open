define("app/ui/api",["jquery"],function(t){var e,i={debug:!1};i.log=function(){this.debug&&console.log("[API] "+arguments[0],Array.prototype.splice.call(arguments,1))};var n=function(t){this.id=t.hasOwnProperty("id")?t.id:null,this.states=t.hasOwnProperty("state")?t.state:[],this.counts=t.hasOwnProperty("counter")?t.counter:[],this.extra=t.hasOwnProperty("extra")?t.extra:{},this._hasState=function(t){return this.states.hasOwnProperty(t)},this._getState=function(t){if(this._hasState(t))return this.states[t];throw'Undefined state "'+t+'"'},this._hasCount=function(t){return this.counts.hasOwnProperty(t)},this._getCount=function(t){if(this._hasCount(t))return this.counts[t];throw'Undefined count "'+t+'"'}};return n.prototype.getId=function(){return this.id},n.prototype.isPinned=function(){return this._getState("is_pinned")},n.prototype.isBanned=function(){return this._getState("is_banned")},n.prototype.isTrashed=function(){return this._getState("is_trashed")},n.prototype.isAdded=function(){return this._getState("is_added")},n.prototype.getPinCount=function(){return this._getCount("pin")},n.prototype.getBanCount=function(){return this._getCount("ban")},n.prototype.getTrashCount=function(){return this._getCount("trash")},n.prototype.getLibraryCount=function(){return this._getCount("library")},n.prototype.getExtra=function(t){if(t){if(this.extra.hasOwnProperty(t))return this.extra[t];throw'Undefined extra "'+t+'"'}return this.extra},i.pin=function(s,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/pin",data:{id:s,source:window.location.pathname}}).done(function(t){t.id=s,t.extra=o,i.log("pin success",t),e.trigger("etalia.publication.pin",new n(t))}).fail(function(t,e,n){i._failureCallback(o),i.log("pin failure",t,e,n)}),this},i.ban=function(s,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/ban",data:{id:s,source:window.location.pathname}}).done(function(t){t.id=s,t.extra=o,i.log("ban success",t),e.trigger("etalia.publication.ban",new n(t))}).fail(function(t,e,n){i._failureCallback(o),i.log("ban failure",t,e,n)}),this},i.add=function(s,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/add",data:{id:s}}).done(function(t){return t.id=s,t.extra=o,t.hasOwnProperty("success")&&!t.success?(i._failureCallback(o),void i.log("add failure",t)):(i.log("add success",t),void e.trigger("etalia.publication.add",new n(t)))}).fail(function(t,e,n){i._failureCallback(o),i.log("add failure",t,e,n)}),this},i.trash=function(s,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/trash",data:{id:s}}).done(function(t){return t.id=s,t.extra=o,t.hasOwnProperty("success")&&!t.success?(i._failureCallback(o),void i.log("trash failure",t)):(i.log("trash success",t),void e.trigger("etalia.publication.trash",new n(t)))}).fail(function(t,e,n){i._failureCallback(o),i.log("trash failure",t,e,n)}),this},i.restore=function(s,o){return o=o||{},t.ajax({type:"POST",url:"/user/paper/restore",data:{id:s}}).done(function(t){return t.id=s,t.extra=o,t.hasOwnProperty("success")&&!t.success?(i._failureCallback(o),void i.log("restore failure",t)):(i.log("restore success",t),void e.trigger("etalia.publication.restore",new n(t)))}).fail(function(t,e,n){i._failureCallback(o),i.log("restore failure",t,e,n)}),this},i.clearTrash=function(s){return s=s||{},t.ajax({type:"POST",url:"/user/library/trash/empty"}).done(function(t){t.extra=s,i.log("clear trash success",t),e.trigger("etalia.publication.trash-clear",new n(t))}).fail(function(t,e,n){i._failureCallback(s),i.log("clear trash failure",t,e,n)}),this},i._failureCallback=function(t){t.hasOwnProperty("failureCallback")&&t.failureCallback()},t(function(){e=t("body")}),i}),define("app/util/utils",["jquery"],function(t){function e(t){var e=null;if(document.cookie&&""!=document.cookie)for(var i=document.cookie.split(";"),n=0;n<i.length;n++){var s=jQuery.trim(i[n]);if(s.substring(0,t.length+1)==t+"="){e=decodeURIComponent(s.substring(t.length+1));break}}return e}function i(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}var n=e("csrftoken");return t.ajaxSetup({beforeSend:function(t,e){i(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",n)}}),{toggleClass:function(t,e,i){return"undefined"!=typeof i?(i?t.addClass(e):t.removeClass(e),i):t.hasClass(e)?(t.removeClass(e),!1):(t.addClass(e),!0)},getParameterByName:function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),n=i.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},bindLoadingButtons:function(e){e.on("click",".loading-button",function(e){var i=t(e.target).closest(".loading-button");return i.data("busy")?(e.stopPropagation(),void e.stopImmediatePropagation()):(i.data("busy",!0),void i.find(".eai").removeAttr("class").addClass("eai eai-loading"))})},restoreLoadingButton:function(t,e){t.data("busy",!1),t.find(".eai").removeAttr("class").addClass("eai "+e)},popup:function(t,e,i,n){e=e||"etalia-popup",i=i||520,n=n||460;var s=Math.round(window.innerWidth/2-i/2),o=Math.round(window.innerHeight/2-n/2),r="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width="+i+",height="+n+",top="+o+",left="+s;return window.open(t,e,r)}}}),define("app/ui/control/search",["jquery","app/util/utils"],function(t,e){var i=function(e){this.config=t.extend({debug:!1,element:"#search",toggle:"#toggle-search",close:"#close-search",input:"#search-input"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.toggle),this.$close=this.$element.find(this.config.close),this.$input=this.$element.find(this.config.input),this.keyUpTimeout=null};return i.prototype.init=function(){var i=this,n=t("body");return this.$toggle.on("click",function(t){return console.log("test"),e.toggleClass(i.$element,"opened"),t.preventDefault(),!1}),this.$close.on("click",function(t){return e.toggleClass(i.$element,"opened"),t.preventDefault(),!1}),this.$input.on("focus",function(e){e.stopPropagation(),t(e.delegateTarget).parents("form").addClass("active")}).on("blur",function(e){e.stopPropagation(),t(e.delegateTarget).parents("form").removeClass("active")}).on("keyup",function(t){i.keyUpTimeout&&clearTimeout(i.keyUpTimeout);var e=t.keyCode||t.which;13==e?n.trigger("etalia.control.search.change",{expression:i.getValue()}):i.keyUpTimeout=setTimeout(function(){n.trigger("etalia.control.search.change",{expression:i.getValue()})},1e3)}),this},i.prototype.setValue=function(t){return this.$input.val(t),this},i.prototype.getValue=function(){return this.$input.val()},i}),define("app/ui/control/timespan",["jquery","app/util/utils"],function(t,e){var i={7:{icon:"W",label:"Week"},30:{icon:"1m",label:"1 month"},60:{icon:"2m",label:"2 months"},365:{icon:"1y",label:"1 year"}},n=function(e){this.config=t.extend({debug:!1,element:"#timespan",toggle:"#toggle-timespan",selection:"#timespan-selection"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.toggle),this.$selection=t(this.config.selection)};return n.getValues=function(){return i},n.getValueIcon=function(t){if(i.hasOwnProperty(t))return i[t].icon;throw"Unexpected timespan value"},n.getValueLabel=function(t){if(i.hasOwnProperty(t))return i[t].label;throw"Unexpected timespan value"},n.prototype.init=function(){var i=this,s=t("body");return this.$toggle.on("click",function(t){return e.toggleClass(i.$element,"opened"),t.preventDefault(),!1}),t(window).on("click",function(e){0==t(e.target).closest(i.config.element).length&&i.$element.removeClass("opened")}),this.$element.on("click",".choices a",function(e){var o=t(e.target).closest("a").data("timespan");return i.setValue(o),i.$toggle.trigger("click"),s.trigger("etalia.control.timespan.change",{value:o,label:n.getValueLabel(o)}),e.preventDefault(),!1}),this},n.prototype.setValue=function(t){return this.$selection.html(n.getValueIcon(t)).data("value",t),this},n.prototype.getValue=function(){return this.$selection.data("value")},n}),define("app/ui/control/cluster",["jquery","app/util/utils"],function(t,e){var i={0:{label:"All"},1:{label:"Purple"},2:{label:"Red"},3:{label:"Orange"},4:{label:"White"}},n=function(e){this.config=t.extend({debug:!1,element:"#cluster",toggle:"#toggle-cluster",selection:"#cluster-selection"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.toggle),this.$selection=t(this.config.selection),this.selected=null};return n.prototype.init=function(){var i=this,n=t("body");return this.$toggle.on("click",function(t){return e.toggleClass(i.$element,"opened"),t.preventDefault(),!1}),t(window).on("click",function(e){0==t(e.target).closest(i.config.element).length&&i.$element.removeClass("opened")}),this.$element.on("click",".choices a",function(e){var s=t(e.target).closest("a").data("cluster");return i.setValue(s),i.$toggle.trigger("click"),n.trigger("etalia.control.timespan.change",{value:s,label:i.getValueColor(s)}),e.preventDefault(),!1}),this},n.prototype.getValueColor=function(t){if(i.hasOwnProperty(t))return i[t].label;throw"Unexpected cluster value"},n.prototype.setValue=function(t){if(t=parseInt(t),this.$selection.removeClass("cluster-"+this.selected),0==t)this.$selection.hide(),this.$toggle.find(".cluster-icon").show();else{if(!(t>0&&4>=t))throw"Unexpected cluster value";this.$selection.css({display:"inline-block"}).addClass("cluster-"+(this.selected-1)),this.$toggle.find(".cluster-icon").hide()}return this.$selection.data("value",t),this.selected=t,this},n.prototype.getValue=function(){return this.$selection.data("value")},n}),define("app/ui/control/pinned",["jquery","app/util/utils"],function(t,e){var i=function(e){this.config=t.extend({debug:!1,element:"#toggle-pinned"},e),this.$element=t(this.config.element)};return i.prototype.init=function(){var i=this,n=t("body");return this.$element.on("click",function(t){var s=e.toggleClass(i.$element,"active");return n.trigger("etalia.control.pinned.change",{active:s}),t.preventDefault(),!1}),this},i.prototype.setValue=function(t){return e.toggleClass(this.$element,"active",t),this},i.prototype.getValue=function(){return this.$element.hasClass("active")},i});var Hogan={};!function(t){function e(t,e,i){var n;return e&&"object"==typeof e&&(void 0!==e[t]?n=e[t]:i&&e.get&&"function"==typeof e.get&&(n=e.get(t))),n}function i(t,e,i,n,s,o){function r(){}function a(){}r.prototype=t,a.prototype=t.subs;var l,h=new r;h.subs=new a,h.subsText={},h.buf="",n=n||{},h.stackSubs=n,h.subsText=o;for(l in e)n[l]||(n[l]=e[l]);for(l in n)h.subs[l]=n[l];s=s||{},h.stackPartials=s;for(l in i)s[l]||(s[l]=i[l]);for(l in s)h.partials[l]=s[l];return h}function n(t){return String(null===t||void 0===t?"":t)}function s(t){return t=n(t),c.test(t)?t.replace(o,"&amp;").replace(r,"&lt;").replace(a,"&gt;").replace(l,"&#39;").replace(h,"&quot;"):t}t.Template=function(t,e,i,n){t=t||{},this.r=t.code||this.r,this.c=i,this.options=n||{},this.text=e||"",this.partials=t.partials||{},this.subs=t.subs||{},this.buf=""},t.Template.prototype={r:function(t,e,i){return""},v:s,t:n,render:function(t,e,i){return this.ri([t],e||{},i)},ri:function(t,e,i){return this.r(t,e,i)},ep:function(t,e){var n=this.partials[t],s=e[n.name];if(n.instance&&n.base==s)return n.instance;if("string"==typeof s){if(!this.c)throw new Error("No compiler available.");s=this.c.compile(s,this.options)}if(!s)return null;if(this.partials[t].base=s,n.subs){e.stackText||(e.stackText={});for(key in n.subs)e.stackText[key]||(e.stackText[key]=void 0!==this.activeSub&&e.stackText[this.activeSub]?e.stackText[this.activeSub]:this.text);s=i(s,n.subs,n.partials,this.stackSubs,this.stackPartials,e.stackText)}return this.partials[t].instance=s,s},rp:function(t,e,i,n){var s=this.ep(t,i);return s?s.ri(e,i,n):""},rs:function(t,e,i){var n=t[t.length-1];if(!u(n))return void i(t,e,this);for(var s=0;s<n.length;s++)t.push(n[s]),i(t,e,this),t.pop()},s:function(t,e,i,n,s,o,r){var a;return u(t)&&0===t.length?!1:("function"==typeof t&&(t=this.ms(t,e,i,n,s,o,r)),a=!!t,!n&&a&&e&&e.push("object"==typeof t?t:e[e.length-1]),a)},d:function(t,i,n,s){var o,r=t.split("."),a=this.f(r[0],i,n,s),l=this.options.modelGet,h=null;if("."===t&&u(i[i.length-2]))a=i[i.length-1];else for(var c=1;c<r.length;c++)o=e(r[c],a,l),void 0!==o?(h=a,a=o):a="";return s&&!a?!1:(s||"function"!=typeof a||(i.push(h),a=this.mv(a,i,n),i.pop()),a)},f:function(t,i,n,s){for(var o=!1,r=null,a=!1,l=this.options.modelGet,h=i.length-1;h>=0;h--)if(r=i[h],o=e(t,r,l),void 0!==o){a=!0;break}return a?(s||"function"!=typeof o||(o=this.mv(o,i,n)),o):s?!1:""},ls:function(t,e,i,s,o){var r=this.options.delimiters;return this.options.delimiters=o,this.b(this.ct(n(t.call(e,s)),e,i)),this.options.delimiters=r,!1},ct:function(t,e,i){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(t,this.options).render(e,i)},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ms:function(t,e,i,n,s,o,r){var a,l=e[e.length-1],h=t.call(l);return"function"==typeof h?n?!0:(a=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(h,l,i,a.substring(s,o),r)):h},mv:function(t,e,i){var s=e[e.length-1],o=t.call(s);return"function"==typeof o?this.ct(n(o.call(s)),s,i):o},sub:function(t,e,i,n){var s=this.subs[t];s&&(this.activeSub=t,s(e,i,this,n),this.activeSub=!1)}};var o=/&/g,r=/</g,a=/>/g,l=/\'/g,h=/\"/g,c=/[&<>\"\']/,u=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}("undefined"!=typeof exports?exports:Hogan),function(t){function e(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function i(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function n(t,e,i){if(e.charAt(i)!=t.charAt(0))return!1;for(var n=1,s=t.length;s>n;n++)if(e.charAt(i+n)!=t.charAt(n))return!1;return!0}function s(e,i,n,a){var l=[],h=null,c=null,u=null;for(c=n[n.length-1];e.length>0;){if(u=e.shift(),c&&"<"==c.tag&&!(u.tag in w))throw new Error("Illegal content in < super tag.");if(t.tags[u.tag]<=t.tags.$||o(u,a))n.push(u),u.nodes=s(e,u.tag,n,a);else{if("/"==u.tag){if(0===n.length)throw new Error("Closing tag without opener: /"+u.n);if(h=n.pop(),u.n!=h.n&&!r(u.n,h.n,a))throw new Error("Nesting error: "+h.n+" vs. "+u.n);return h.end=u.i,l}"\n"==u.tag&&(u.last=0==e.length||"\n"==e[0].tag)}l.push(u)}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return l}function o(t,e){for(var i=0,n=e.length;n>i;i++)if(e[i].o==t.n)return t.tag="#",!0}function r(t,e,i){for(var n=0,s=i.length;s>n;n++)if(i[n].c==t&&i[n].o==e)return!0}function a(t){var e=[];for(var i in t)e.push('"'+h(i)+'": function(c,p,t,i) {'+t[i]+"}");return"{ "+e.join(",")+" }"}function l(t){var e=[];for(var i in t.partials)e.push('"'+h(i)+'":{name:"'+h(t.partials[i].name)+'", '+l(t.partials[i])+"}");return"partials: {"+e.join(",")+"}, subs: "+a(t.subs)}function h(t){return t.replace(b,"\\\\").replace(g,'\\"').replace(v,"\\n").replace(m,"\\r").replace(y,"\\u2028").replace(x,"\\u2029")}function c(t){return~t.indexOf(".")?"d":"f"}function u(t,e){var i="<"+(e.prefix||""),n=i+t.n+S++;return e.partials[n]={name:t.n,partials:{}},e.code+='t.b(t.rp("'+h(n)+'",c,p,"'+(t.indent||"")+'"));',n}function p(t,e){e.code+="t.b(t.t(t."+c(t.n)+'("'+h(t.n)+'",c,p,0)));'}function d(t){return"t.b("+t+");"}var f=/\S/,g=/\"/g,v=/\n/g,m=/\r/g,b=/\\/g,y=/\u2028/,x=/\u2029/;t.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},t.scan=function(s,o){function r(){b.length>0&&(y.push({tag:"_t",text:new String(b)}),b="")}function a(){for(var e=!0,i=S;i<y.length;i++)if(e=t.tags[y[i].tag]<t.tags._v||"_t"==y[i].tag&&null===y[i].text.match(f),!e)return!1;return e}function l(t,e){if(r(),t&&a())for(var i,n=S;n<y.length;n++)y[n].text&&((i=y[n+1])&&">"==i.tag&&(i.indent=y[n].text.toString()),y.splice(n,1));else e||y.push({tag:"\n"});x=!1,S=y.length}function h(t,e){var n="="+T,s=t.indexOf(n,e),o=i(t.substring(t.indexOf("=",e)+1,s)).split(" ");return k=o[0],T=o[o.length-1],s+n.length-1}var c=s.length,u=0,p=1,d=2,g=u,v=null,m=null,b="",y=[],x=!1,w=0,S=0,k="{{",T="}}";for(o&&(o=o.split(" "),k=o[0],T=o[1]),w=0;c>w;w++)g==u?n(k,s,w)?(--w,r(),g=p):"\n"==s.charAt(w)?l(x):b+=s.charAt(w):g==p?(w+=k.length-1,m=t.tags[s.charAt(w+1)],v=m?s.charAt(w+1):"_v","="==v?(w=h(s,w),g=u):(m&&w++,g=d),x=w):n(T,s,w)?(y.push({tag:v,n:i(b),otag:k,ctag:T,i:"/"==v?x-k.length:w+T.length}),b="",w+=T.length-1,g=u,"{"==v&&("}}"==T?w++:e(y[y.length-1]))):b+=s.charAt(w);return l(x,!0),y};var w={_t:!0,"\n":!0,$:!0,"/":!0};t.stringify=function(e,i,n){return"{code: function (c,p,i) { "+t.wrapMain(e.code)+" },"+l(e)+"}"};var S=0;t.generate=function(e,i,n){S=0;var s={code:"",subs:{},partials:{}};return t.walk(e,s),n.asString?this.stringify(s,i,n):this.makeTemplate(s,i,n)},t.wrapMain=function(t){return'var t=this;t.b(i=i||"");'+t+"return t.fl();"},t.template=t.Template,t.makeTemplate=function(t,e,i){var n=this.makePartials(t);return n.code=new Function("c","p","i",this.wrapMain(t.code)),new this.template(n,e,this,i)},t.makePartials=function(t){var e,i={subs:{},partials:t.partials,name:t.name};for(e in i.partials)i.partials[e]=this.makePartials(i.partials[e]);for(e in t.subs)i.subs[e]=new Function("c","p","t","i",t.subs[e]);return i},t.codegen={"#":function(e,i){i.code+="if(t.s(t."+c(e.n)+'("'+h(e.n)+'",c,p,1),c,p,0,'+e.i+","+e.end+',"'+e.otag+" "+e.ctag+'")){t.rs(c,p,function(c,p,t){',t.walk(e.nodes,i),i.code+="});c.pop();}"},"^":function(e,i){i.code+="if(!t.s(t."+c(e.n)+'("'+h(e.n)+'",c,p,1),c,p,1,0,0,"")){',t.walk(e.nodes,i),i.code+="};"},">":u,"<":function(e,i){var n={partials:{},code:"",subs:{},inPartial:!0};t.walk(e.nodes,n);var s=i.partials[u(e,i)];s.subs=n.subs,s.partials=n.partials},$:function(e,i){var n={subs:{},code:"",partials:i.partials,prefix:e.n};t.walk(e.nodes,n),i.subs[e.n]=n.code,i.inPartial||(i.code+='t.sub("'+h(e.n)+'",c,p,i);')},"\n":function(t,e){e.code+=d('"\\n"'+(t.last?"":" + i"))},_v:function(t,e){e.code+="t.b(t.v(t."+c(t.n)+'("'+h(t.n)+'",c,p,0)));'},_t:function(t,e){e.code+=d('"'+h(t.text)+'"')},"{":p,"&":p},t.walk=function(e,i){for(var n,s=0,o=e.length;o>s;s++)n=t.codegen[e[s].tag],n&&n(e[s],i);return i},t.parse=function(t,e,i){return i=i||{},s(t,"",[],i.sectionTags||[])},t.cache={},t.cacheKey=function(t,e){return[t,!!e.asString,!!e.disableLambda,e.delimiters,!!e.modelGet].join("||")},t.compile=function(e,i){i=i||{};var n=t.cacheKey(e,i),s=this.cache[n];if(s){var o=s.partials;for(var r in o)delete o[r].instance;return s}return s=this.generate(this.parse(this.scan(e,i.delimiters),e,i),e,i),this.cache[n]=s}}("undefined"!=typeof exports?exports:Hogan),"function"==typeof define&&define.amd&&define("hogan",Hogan),define("app/util/templates",["require","hogan"],function(t){var e=t("hogan"),i={};return i.filters=new e.Template({code:function(t,e,i){var n=this;return n.b(i=i||""),n.s(n.f("groups",t,e,1),t,e,0,11,771,"{{ }}")&&(n.rs(t,e,function(t,e,n){n.b('<div class="filter-group" data-id="'),n.b(n.v(n.f("id",t,e,0))),n.b('">'),n.b("\n"+i),n.b('    <a href="javascript: void(0)" class="filter-toggle">'),n.b("\n"+i),n.b("        "),n.b(n.v(n.f("id",t,e,0))),n.b(' <span class="eai eai-down"></span>'),n.b("\n"+i),n.b("    </a>"),n.b("\n"+i),n.b('    <div class="filter-filters collapse">'),n.b("\n"+i),n.b("        <ul>"),n.b("\n"+i),n.s(n.f("entries",t,e,1),t,e,0,251,621,"{{ }}")&&(n.rs(t,e,function(t,e,n){n.b("            <li>"),n.b("\n"+i),n.b('                <a href="javascript: void(0)" data-id="'),n.b(n.v(n.f("pk",t,e,0))),n.b('" title="'),n.b(n.v(n.f("name",t,e,0))),n.b('"'),n.b("\n"+i),n.b("                    "),n.s(n.f("is_checked",t,e,1),t,e,0,384,400,"{{ }}")&&(n.rs(t,e,function(t,e,i){i.b(' class="active" ')}),t.pop()),n.b(">"),n.b("\n"+i),n.b("                    "),n.s(n.f("count",t,e,1),t,e,0,447,492,"{{ }}")&&(n.rs(t,e,function(t,e,i){i.b('<span class="filter-count">('),i.b(i.v(i.f("count",t,e,0))),i.b(")</span>")}),t.pop()),n.b("\n"+i),n.b('                    <span class="filter-checkbox"></span> '),n.b(n.v(n.f("name",t,e,0))),n.b("\n"+i),n.b("                </a>"),n.b("\n"+i),n.b("            </li>"),n.b("\n"+i)}),t.pop()),n.b("        </ul>"),n.b("\n"+i),n.b('        <a href="javascript: void(0)" class="filter-more">'),n.b("\n"+i),n.b("            More filters&hellip;"),n.b("\n"+i),n.b("        </a>"),n.b("\n"+i),n.b("    </div>"),n.b("\n"+i),n.b("</div>"),n.b("\n"+i)}),t.pop()),n.fl()},partials:{},subs:{}}),i}),define("app/ui/control/filters",["jquery","app/util/templates","app/util/utils"],function(t,e,i){var n={id:[],opened:[],count:[]};n.has=function(t){return 0<=this.id.indexOf(t)},n.add=function(t,e,i){this.has(t)&&this.set(t,e,i),this.id.push(t),this.opened.push(e),this.count.push(i)},n.set=function(t,e,i){this.has(t)||this.add(t,e,i);var n=this.id.indexOf(t);this.opened[n]=e,this.count[n]=i},n.get=function(t){if(!this.has(t))throw'Undefined group "'+t+'"';var e=this.id.indexOf(t);return{opened:this.opened[e],count:this.count[e]}},n.setOpened=function(t,e){if(!this.has(t))throw'Undefined group "'+t+'"';var i=this.id.indexOf(t);this.opened[i]=e},n.getOpened=function(t){if(!this.has(t))throw'Undefined group "'+t+'"';return this.opened[this.id.indexOf(t)]},n.setCount=function(t,e){if(!this.has(t))throw'Undefined group "'+t+'"';var i=this.id.indexOf(t);this.count[i]=e},n.getCount=function(t){if(!this.has(t))throw'Undefined group "'+t+'"';return this.count[this.id.indexOf(t)]};var s=function(e){this.config=t.extend({debug:!1,element:"#filter-flap"},e),this.$element=t(this.config.element),this.$toggle=t(this.config.selection),this.$selection=t(this.config.selection),this.selected=null};return s.prototype.init=function(){var e=this,s=t("body");return this.$element.find(".filter-group").each(function(i,s){var o=t(s),r=o.find(".filter-filters ul a:visible").length;n.add(o.data("id"),o.hasClass("active"),r),e.applyUserSelection(o)}),this.$element.on("click",".filter-toggle",function(e){var s=t(e.target).closest(".filter-group"),o=s.data("id");i.toggleClass(s,"active")?(s.find(".filter-filters").collapse("show"),n.setOpened(o,!0)):(s.find(".filter-filters").collapse("hide"),n.setOpened(o,!1))}).on("click",".filter-group ul a",function(e){var n=t(e.target).closest("a"),o=n.closest(".filter-group"),r=i.toggleClass(n,"active");s.trigger("etalia.control.filters.change",{value:n.data("id"),label:n.attr("title"),group:o.data("id"),active:r})}).on("click",".filter-more",function(i){var o=t(i.target).closest(".filter-group"),r=o.data("id"),a=n.getCount(r);n.setCount(r,a+10),e.applyUserSelection(o),s.trigger("etalia.control.filters.more",{group:o.data("id"),count:a}),t(window).trigger("resize")}),this},s.prototype.applyUserSelection=function(t){var e=t.find("ul li"),i=n.get(t.data("id"));return i.opened?t.addClass("active").find(".filter-filters").addClass("in"):t.removeClass("active").find(".filter-filters").removeClass("in"),i.count>=e.length?(e.show(),t.find(".filter-more").hide()):(e.filter(":lt("+i.count+")").show(),e.filter(":gt("+(i.count-1)+")").hide(),t.find(".filter-more").show()),this},s.prototype.render=function(i){var n=this;return this.$element.html(e.filters.render({groups:i})).find(".filter-group").each(function(e,i){n.applyUserSelection(t(i))}),this},s.prototype.setValue=function(){throw"Not implemented"},s.prototype.getValue=function(){var e=[];return this.$element.find(".filter-group").each(function(i,n){var s=t(n),o=[];s.find("li a.active").each(function(){o.push(t(this).data("id"))}),e.push({id:s.data("id"),pk:o})}),e},s}),define("app/ui/controls",["jquery","app/ui/control/search","app/ui/control/timespan","app/ui/control/cluster","app/ui/control/pinned","app/ui/control/filters"],function(t,e,i,n,s,o){var r={search:(new e).init(),timespan:(new i).init(),cluster:(new n).init(),pinned:(new s).init(),filters:(new o).init()};return r.getStates=function(){return{time_span:this.timespan.getValue(),cluster:this.cluster.getValue(),pin:this.pinned.getValue(),search_query:this.search.getValue(),filters:this.filters.getValue()}},r.setStates=function(t){return t.hasOwnProperty("cluster")&&this.cluster.setValue(t.cluster||0),t.hasOwnProperty("time_span")&&this.timespan.setValue(t.time_span),t.hasOwnProperty("pin")&&this.pinned.setValue(t.pin),t.hasOwnProperty("search_query")&&this.search.setValue(t.search_query),t.hasOwnProperty("filters")&&this.filters.render(t.filters),this},r}),define("app/ui/list",["jquery","app/ui/api","app/util/utils","altmetric"],function(t,e,i){var n=function(e){this.config=t.extend({debug:!1,element:"#list",container:".thumb-list"},e),this.$element=t(this.config.element),this.loadXhr=null};return n.prototype.log=function(){return this.config.debug&&console.log("[List] "+arguments[0],Array.prototype.splice.call(arguments,1)),this},n.prototype.init=function(){function n(t){return{source:"thumb",title:t.data("paper-title")}}return this.log("init",this.$element),i.bindLoadingButtons(this.$element),this.$element.on("click",".thumb-pin",function(i){var s=t(i.target).closest(".thumb");return e.pin(s.data("paper-id"),n(s)),i.preventDefault(),!1}).on("click",".thumb-ban",function(i){var s=t(i.target).closest(".thumb");return e.ban(s.data("paper-id"),n(s)),i.preventDefault(),!1}).on("click",".thumb-library-add",function(s){var o=t(s.target).closest(".thumb-library-add"),r=t(s.target).closest(".thumb"),a=n(r);return a.failureCallback=function(){i.restoreLoadingButton(o,"eai-library-add")},e.add(r.data("paper-id"),a),s.preventDefault(),!1}).on("click",".thumb-library-trash",function(s){var o=t(s.target).closest(".thumb-library-trash"),r=t(s.target).closest(".thumb"),a=n(r);return a.failureCallback=function(){i.restoreLoadingButton(o,"eai-library-trash")},e.trash(r.data("paper-id"),a),s.preventDefault(),!1}).on("click",".thumb-library-restore",function(s){var o=t(s.target).closest(".thumb-library-restore"),r=t(s.target).closest(".thumb"),a=n(r);return a.failureCallback=function(){i.restoreLoadingButton(o,"eai-library-add")},e.restore(r.data("paper-id"),a),s.preventDefault(),!1}),this},n.prototype.load=function(e){e=e||{},this.loadXhr&&this.loadXhr.abort();var i=this;t("body");return i.$element.find(i.config.container).empty().append(t("#busy-modal .sk-cube-grid").clone()),this.loadXhr=t.ajax({method:"GET",url:i.$element.data("load-url"),data:{data:JSON.stringify(e)},dataType:"xml"}).done(function(e){var n={},s=t(e).find("data");s.length&&(s=JSON.parse(s.text()),s.hasOwnProperty("number_of_papers")&&i.$element.find(".list-title span").html(s.number_of_papers),n.controlsStates=s);var o=t(e).find("thumb-list");o.length&&i.$element.find(i.config.container).html(t(o.text())),_altmetric_embed_init(),t(i).trigger("etalia.list.load",n)}).fail(function(t,e,n){i.log("Load failure",t,e,n)}),this.log("load",i.$element.data("load-url")),this},n}),define("app/util/sticky",["jquery"],function(t){var e=function(e){function i(t){r.debug&&console.log("[Sticky] "+t)}function n(){if(d=l.scrollTop(),f=0,i("scrollHandler : "+f+" / "+d),null!==c&&g){f=parseInt(a.css("top"));var t=c-d;f+=t,0>t?(f+u<d+p-r.bottom&&(f=d+p-u-r.bottom),i("scrolling down : "+f)):(f>d+r.top&&(f=d+r.top),i("scrolling up : "+f))}else f<d+r.top&&(f=d+r.top),i("fixed : "+f);c=d,a.css({top:f})}function s(){u=a.outerHeight(),p=l.innerHeight(),i("resizeTimeoutHandler : "+u+" / "+p),g=u>p}function o(){h&&clearTimeout(h),h=setTimeout(s,150)}var r=t.extend({debug:!0,element:null,parent:null,top:0,bottom:0},e),a=t(r.element),l=t(r.parent?r.parent:window),h=null,c=null,u=0,p=0,d=0,f=0,g=!1;this.addHandlers=function(){l.on("scroll",n),t(window).on("resize",o),s(),n()},this.removeHandlers=function(){l.off("scroll",n),t(window).off("resize",o),a.css({position:"absolute",top:"0px"}),c=null},this.enabled=!1};return e.prototype.enable=function(){this.enabled||(this.addHandlers(),this.enabled=!0)},e.prototype.disable=function(){this.enabled&&(this.removeHandlers(),this.enabled=!1)},e}),define("app/ui/paper",["jquery","app/ui/api","app/util/utils","app/ui/controls","app/ui/control/timespan","app/ui/list","app/util/sticky"],function(t,e,i,n,s,o,r){function a(t,e){e?(t.removeClass("detail-library-add detail-library-restore").addClass("detail-library-trash"),i.restoreLoadingButton(t,"eai-library-trash")):(t.removeClass("detail-library-trash").addClass("detail-library-restore"),i.restoreLoadingButton(t,"eai-library-add"))}var l=function(e){this.config=t.extend({debug:!1,element:"#detail",document:".document",actions:".inner > .actions",neighbors:".neighbors-thumbs"},e),this.$element=t(this.config.element),this.$document=this.$element.find(this.config.document),this.id=null,this.$actions=null,this.actions=null,this.neighbors=null};return l.prototype.log=function(){this.config.debug&&console.log("[Paper] "+arguments[0],Array.prototype.splice.call(arguments,1))},l.prototype.getId=function(){return this.id},l.prototype.init=function(){function n(){return{source:"detail",title:o.$actions.data("paper-title")}}this.log("init");var o=this,r=t("body");return r.on("etalia.publication.pin",function(t,e){o.id==e.getId()&&o.$actions.find(".detail-pin").toggleClass("active",e.isPinned())}).on("etalia.publication.add",function(t,e){if(o.id==e.getId()&&e.isAdded()){var i=o.$actions.find(".detail-library-add");a(i,!0)}}).on("etalia.publication.trash",function(t,e){if(o.id==e.getId()&&e.isTrashed()){var i=o.$actions.find(".detail-library-trash");a(i,!1)}}).on("etalia.publication.restore",function(t,e){if(o.id==e.getId()&&e.isAdded()){var i=o.$actions.find(".detail-library-restore");a(i,!0)}}),this.$document.on("click",".neighbors-timespan-selector a",function(e){var i=t(e.target).closest("a"),n=i.data("value");return i.closest(".neighbors-timespan-selector").find("li").removeClass("active"),i.closest("li").addClass("active"),o.neighbors&&o.neighbors.load({time_span:n}),r.trigger("etalia.detail.similar_timespan.change",{value:n,label:s.getValueLabel(n)}),e.preventDefault(),!1}).on("click",".detail-questions",function(t){var e=o.$document.find(".questions-thumbs").position().top-15;return o.$document.scrollTop(e),t.preventDefault(),!1}).on("click",".detail-neighbors",function(t){var e=o.$document.find(".neighbors-thumbs").position().top-15;return o.$document.scrollTop(e),t.preventDefault(),!1}).on("click",".detail-pin",function(t){if(!o.id)throw"Undefined paper id";return e.pin(o.id,n()),t.preventDefault(),!1}).on("click",".detail-ban",function(t){if(!o.id)throw"Undefined paper id";return e.ban(o.id,n()),t.preventDefault(),!1}).on("click",".detail-library-add:visible",function(s){if(!o.id)throw"Undefined paper id";var r=t(s.target).closest(".detail-library-add"),a=n();return a.failureCallback=function(){i.restoreLoadingButton(r,"eai-library-add")},e.add(o.id,a),s.preventDefault(),!1}).on("click",".detail-library-trash:visible",function(s){if(!o.id)throw"Undefined paper id";var r=t(s.target).closest(".detail-library-trash"),a=n();return a.failureCallback=function(){i.restoreLoadingButton(r,"eai-library-trash")},e.trash(o.id,a),s.preventDefault(),!1}).on("click",".detail-library-restore:visible",function(s){if(!o.id)throw"Undefined paper id";var r=t(s.target).closest(".detail-library-restore"),a=n();return a.failureCallback=function(){i.restoreLoadingButton(r,"eai-library-add")},e.restore(o.id,a),s.preventDefault(),!1}).on("click",".detail-twitter:visible",function(e){var s=t("#detail-actions"),a="https://twitter.com/intent/tweet/?text="+s.data("paper-title")+"&url="+s.data("paper-url")+"&via=etalia";i.popup(a,"share-popup");var l=n();return l.id=o.id,l.support="twitter",r.trigger("etalia.publication.share",l),e.preventDefault(),!1}).on("click",".detail-google-plus:visible",function(e){var s=t("#detail-actions"),a="https://plus.google.com/share?url="+s.data("paper-url");i.popup(a,"share-popup");var l=n();return l.id=o.id,l.support="google-plus",r.trigger("etalia.publication.share",l),e.preventDefault(),!1}).on("click",".detail-mail:visible",function(){var t=n();t.id=o.id,t.support="email",r.trigger("etalia.publication.share",t)}),this},l.prototype.update=function(){this.log("update"),this.$actions=this.$element.find(this.config.actions),i.bindLoadingButtons(this.$actions),
this.id=parseInt(this.$actions.data("paper-id")),this.actions=new r({debug:this.config.debug,element:this.$actions,parent:this.$document,top:20,bottom:20}),this.actions.enable();var e=t(".neighbors-timespan-selector li.active a").data("value")||30;return this.neighbors=new o({debug:this.config.debug,element:this.config.element+" "+this.config.neighbors}).init().load({time_span:e}),this},l.prototype.clear=function(){this.actions&&(this.actions.disable(),this.actions=null),this.$actions&&(this.$actions=null),this.neighbors=null,this.id&&(this.id=null)},l}),function(t,e,i){function n(t,i){this.wrapper="string"==typeof t?e.querySelector(t):t,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var n in i)this.options[n]=i[n];this.translateZ=this.options.HWCompositing&&a.hasPerspective?" translateZ(0)":"",this.options.useTransition=a.hasTransition&&this.options.useTransition,this.options.useTransform=a.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?a.ease[this.options.bounceEasing]||a.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function s(t,i,n){var s=e.createElement("div"),o=e.createElement("div");return n===!0&&(s.style.cssText="position:absolute;z-index:9999",o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),o.className="iScrollIndicator","h"==t?(n===!0&&(s.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",o.style.height="100%"),s.className="iScrollHorizontalScrollbar"):(n===!0&&(s.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",o.style.width="100%"),s.className="iScrollVerticalScrollbar"),s.style.cssText+=";overflow:hidden",i||(s.style.pointerEvents="none"),s.appendChild(o),s}function o(i,n){this.wrapper="string"==typeof n.el?e.querySelector(n.el):n.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=i,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var s in n)this.options[s]=n[s];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(a.addEvent(this.indicator,"touchstart",this),a.addEvent(t,"touchend",this)),this.options.disablePointer||(a.addEvent(this.indicator,a.prefixPointerEvent("pointerdown"),this),a.addEvent(t,a.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(a.addEvent(this.indicator,"mousedown",this),a.addEvent(t,"mouseup",this))),this.options.fade&&(this.wrapperStyle[a.style.transform]=this.scroller.translateZ,this.wrapperStyle[a.style.transitionDuration]=a.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var r=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},a=function(){function n(t){return r===!1?!1:""===r?t:r+t.charAt(0).toUpperCase()+t.substr(1)}var s={},o=e.createElement("div").style,r=function(){for(var t,e=["t","webkitT","MozT","msT","OT"],i=0,n=e.length;n>i;i++)if(t=e[i]+"ransform",t in o)return e[i].substr(0,e[i].length-1);return!1}();s.getTime=Date.now||function(){return(new Date).getTime()},s.extend=function(t,e){for(var i in e)t[i]=e[i]},s.addEvent=function(t,e,i,n){t.addEventListener(e,i,!!n)},s.removeEvent=function(t,e,i,n){t.removeEventListener(e,i,!!n)},s.prefixPointerEvent=function(e){return t.MSPointerEvent?"MSPointer"+e.charAt(9).toUpperCase()+e.substr(10):e},s.momentum=function(t,e,n,s,o,r){var a,l,h=t-e,c=i.abs(h)/n;return r=void 0===r?6e-4:r,a=t+c*c/(2*r)*(0>h?-1:1),l=c/r,s>a?(a=o?s-o/2.5*(c/8):s,h=i.abs(a-t),l=h/c):a>0&&(a=o?o/2.5*(c/8):0,h=i.abs(t)+a,l=h/c),{destination:i.round(a),duration:l}};var a=n("transform");return s.extend(s,{hasTransform:a!==!1,hasPerspective:n("perspective")in o,hasTouch:"ontouchstart"in t,hasPointer:t.PointerEvent||t.MSPointerEvent,hasTransition:n("transition")in o}),s.isBadAndroid=/Android /.test(t.navigator.appVersion)&&!/Chrome\/\d/.test(t.navigator.appVersion),s.extend(s.style={},{transform:a,transitionTimingFunction:n("transitionTimingFunction"),transitionDuration:n("transitionDuration"),transitionDelay:n("transitionDelay"),transformOrigin:n("transformOrigin")}),s.hasClass=function(t,e){var i=new RegExp("(^|\\s)"+e+"(\\s|$)");return i.test(t.className)},s.addClass=function(t,e){if(!s.hasClass(t,e)){var i=t.className.split(" ");i.push(e),t.className=i.join(" ")}},s.removeClass=function(t,e){if(s.hasClass(t,e)){var i=new RegExp("(^|\\s)"+e+"(\\s|$)","g");t.className=t.className.replace(i," ")}},s.offset=function(t){for(var e=-t.offsetLeft,i=-t.offsetTop;t=t.offsetParent;)e-=t.offsetLeft,i-=t.offsetTop;return{left:e,top:i}},s.preventDefaultException=function(t,e){for(var i in e)if(e[i].test(t[i]))return!0;return!1},s.extend(s.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),s.extend(s.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(t){return t*(2-t)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(t){return i.sqrt(1- --t*t)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(t){var e=4;return(t-=1)*t*((e+1)*t+e)+1}},bounce:{style:"",fn:function(t){return(t/=1)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},elastic:{style:"",fn:function(t){var e=.22,n=.4;return 0===t?0:1==t?1:n*i.pow(2,-10*t)*i.sin((t-e/4)*(2*i.PI)/e)+1}}}),s.tap=function(t,i){var n=e.createEvent("Event");n.initEvent(i,!0,!0),n.pageX=t.pageX,n.pageY=t.pageY,t.target.dispatchEvent(n)},s.click=function(t){var i,n=t.target;/(SELECT|INPUT|TEXTAREA)/i.test(n.tagName)||(i=e.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!0,t.view,1,n.screenX,n.screenY,n.clientX,n.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),i._constructed=!0,n.dispatchEvent(i))},s}();n.prototype={version:"5.1.3",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(t){t.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(t){if((1==a.eventType[t.type]||0===t.button)&&this.enabled&&(!this.initiated||a.eventType[t.type]===this.initiated)){!this.options.preventDefault||a.isBadAndroid||a.preventDefaultException(t.target,this.options.preventDefaultException)||t.preventDefault();var e,n=t.touches?t.touches[0]:t;this.initiated=a.eventType[t.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=a.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,e=this.getComputedPosition(),this._translate(i.round(e.x),i.round(e.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=n.pageX,this.pointY=n.pageY,this._execEvent("beforeScrollStart")}},_move:function(t){if(this.enabled&&a.eventType[t.type]===this.initiated){this.options.preventDefault&&t.preventDefault();var e,n,s,o,r=t.touches?t.touches[0]:t,l=r.pageX-this.pointX,h=r.pageY-this.pointY,c=a.getTime();if(this.pointX=r.pageX,this.pointY=r.pageY,this.distX+=l,this.distY+=h,s=i.abs(this.distX),o=i.abs(this.distY),!(c-this.endTime>300&&10>s&&10>o)){if(this.directionLocked||this.options.freeScroll||(s>o+this.options.directionLockThreshold?this.directionLocked="h":o>=s+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)t.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);h=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)t.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);l=0}l=this.hasHorizontalScroll?l:0,h=this.hasVerticalScroll?h:0,e=this.x+l,n=this.y+h,(e>0||e<this.maxScrollX)&&(e=this.options.bounce?this.x+l/3:e>0?0:this.maxScrollX),(n>0||n<this.maxScrollY)&&(n=this.options.bounce?this.y+h/3:n>0?0:this.maxScrollY),this.directionX=l>0?-1:0>l?1:0,this.directionY=h>0?-1:0>h?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(e,n),c-this.startTime>300&&(this.startTime=c,this.startX=this.x,this.startY=this.y)}}},_end:function(t){if(this.enabled&&a.eventType[t.type]===this.initiated){this.options.preventDefault&&!a.preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault();var e,n,s=(t.changedTouches?t.changedTouches[0]:t,a.getTime()-this.startTime),o=i.round(this.x),r=i.round(this.y),l=i.abs(o-this.startX),h=i.abs(r-this.startY),c=0,u="";if(this.isInTransition=0,this.initiated=0,this.endTime=a.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(o,r),!this.moved)return this.options.tap&&a.tap(t,this.options.tap),this.options.click&&a.click(t),void this._execEvent("scrollCancel");if(this._events.flick&&200>s&&100>l&&100>h)return void this._execEvent("flick");if(this.options.momentum&&300>s&&(e=this.hasHorizontalScroll?a.momentum(this.x,this.startX,s,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:o,duration:0},n=this.hasVerticalScroll?a.momentum(this.y,this.startY,s,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:r,duration:0},o=e.destination,r=n.destination,c=i.max(e.duration,n.duration),this.isInTransition=1),this.options.snap){var p=this._nearestSnap(o,r);this.currentPage=p,c=this.options.snapSpeed||i.max(i.max(i.min(i.abs(o-p.x),1e3),i.min(i.abs(r-p.y),1e3)),300),o=p.x,r=p.y,this.directionX=0,this.directionY=0,u=this.options.bounceEasing}return o!=this.x||r!=this.y?((o>0||o<this.maxScrollX||r>0||r<this.maxScrollY)&&(u=a.ease.quadratic),void this.scrollTo(o,r,c,u)):void this._execEvent("scrollEnd")}}},_resize:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.refresh()},this.options.resizePolling)},resetPosition:function(t){var e=this.x,i=this.y;return t=t||0,!this.hasHorizontalScroll||this.x>0?e=0:this.x<this.maxScrollX&&(e=this.maxScrollX),!this.hasVerticalScroll||this.y>0?i=0:this.y<this.maxScrollY&&(i=this.maxScrollY),e==this.x&&i==this.y?!1:(this.scrollTo(e,i,t,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=a.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)},off:function(t,e){if(this._events[t]){var i=this._events[t].indexOf(e);i>-1&&this._events[t].splice(i,1)}},_execEvent:function(t){if(this._events[t]){var e=0,i=this._events[t].length;if(i)for(;i>e;e++)this._events[t][e].apply(this,[].slice.call(arguments,1))}},scrollBy:function(t,e,i,n){t=this.x+t,e=this.y+e,i=i||0,this.scrollTo(t,e,i,n)},scrollTo:function(t,e,i,n){n=n||a.ease.circular,this.isInTransition=this.options.useTransition&&i>0,!i||this.options.useTransition&&n.style?(this._transitionTimingFunction(n.style),this._transitionTime(i),this._translate(t,e)):this._animate(t,e,i,n.fn)},scrollToElement:function(t,e,n,s,o){if(t=t.nodeType?t:this.scroller.querySelector(t)){var r=a.offset(t);r.left-=this.wrapperOffset.left,r.top-=this.wrapperOffset.top,n===!0&&(n=i.round(t.offsetWidth/2-this.wrapper.offsetWidth/2)),s===!0&&(s=i.round(t.offsetHeight/2-this.wrapper.offsetHeight/2)),r.left-=n||0,r.top-=s||0,r.left=r.left>0?0:r.left<this.maxScrollX?this.maxScrollX:r.left,r.top=r.top>0?0:r.top<this.maxScrollY?this.maxScrollY:r.top,e=void 0===e||null===e||"auto"===e?i.max(i.abs(this.x-r.left),i.abs(this.y-r.top)):e,this.scrollTo(r.left,r.top,e,o)}},_transitionTime:function(t){if(t=t||0,this.scrollerStyle[a.style.transitionDuration]=t+"ms",!t&&a.isBadAndroid&&(this.scrollerStyle[a.style.transitionDuration]="0.001s"),this.indicators)for(var e=this.indicators.length;e--;)this.indicators[e].transitionTime(t)},_transitionTimingFunction:function(t){if(this.scrollerStyle[a.style.transitionTimingFunction]=t,this.indicators)for(var e=this.indicators.length;e--;)this.indicators[e].transitionTimingFunction(t)},_translate:function(t,e){if(this.options.useTransform?this.scrollerStyle[a.style.transform]="translate("+t+"px,"+e+"px)"+this.translateZ:(t=i.round(t),e=i.round(e),this.scrollerStyle.left=t+"px",this.scrollerStyle.top=e+"px"),this.x=t,this.y=e,this.indicators)for(var n=this.indicators.length;n--;)this.indicators[n].updatePosition()},_initEvents:function(e){var i=e?a.removeEvent:a.addEvent,n=this.options.bindToWrapper?this.wrapper:t;i(t,"orientationchange",this),i(t,"resize",this),this.options.click&&i(this.wrapper,"click",this,!0),this.options.disableMouse||(i(this.wrapper,"mousedown",this),i(n,"mousemove",this),i(n,"mousecancel",this),i(n,"mouseup",this)),a.hasPointer&&!this.options.disablePointer&&(i(this.wrapper,a.prefixPointerEvent("pointerdown"),this),i(n,a.prefixPointerEvent("pointermove"),this),i(n,a.prefixPointerEvent("pointercancel"),this),i(n,a.prefixPointerEvent("pointerup"),this)),a.hasTouch&&!this.options.disableTouch&&(i(this.wrapper,"touchstart",this),i(n,"touchmove",this),i(n,"touchcancel",this),i(n,"touchend",this)),i(this.scroller,"transitionend",this),i(this.scroller,"webkitTransitionEnd",this),i(this.scroller,"oTransitionEnd",this),i(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var e,i,n=t.getComputedStyle(this.scroller,null);return this.options.useTransform?(n=n[a.style.transform].split(")")[0].split(", "),e=+(n[12]||n[4]),i=+(n[13]||n[5])):(e=+n.left.replace(/[^-\d.]/g,""),i=+n.top.replace(/[^-\d.]/g,"")),{x:e,y:i}},_initIndicators:function(){function t(t){for(var e=a.indicators.length;e--;)t.call(a.indicators[e])}var e,i=this.options.interactiveScrollbars,n="string"!=typeof this.options.scrollbars,r=[],a=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(e={el:s("v",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:n,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(e.el),r.push(e)),this.options.scrollX&&(e={el:s("h",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:n,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(e.el),r.push(e))),this.options.indicators&&(r=r.concat(this.options.indicators));for(var l=r.length;l--;)this.indicators.push(new o(this,r[l]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){t(function(){this.fade()})}),this.on("scrollCancel",function(){t(function(){this.fade()})}),this.on("scrollStart",function(){t(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){t(function(){this.fade(1,!0)})})),this.on("refresh",function(){t(function(){this.refresh()})}),this.on("destroy",function(){t(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){a.addEvent(this.wrapper,"wheel",this),a.addEvent(this.wrapper,"mousewheel",this),a.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){a.removeEvent(this.wrapper,"wheel",this),a.removeEvent(this.wrapper,"mousewheel",this),a.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(t){if(this.enabled){t.preventDefault(),t.stopPropagation();var e,n,s,o,r=this;if(void 0===this.wheelTimeout&&r._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){r._execEvent("scrollEnd"),r.wheelTimeout=void 0},400),"deltaX"in t)1===t.deltaMode?(e=-t.deltaX*this.options.mouseWheelSpeed,n=-t.deltaY*this.options.mouseWheelSpeed):(e=-t.deltaX,n=-t.deltaY);else if("wheelDeltaX"in t)e=t.wheelDeltaX/120*this.options.mouseWheelSpeed,n=t.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in t)e=n=t.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in t))return;e=n=-t.detail/3*this.options.mouseWheelSpeed}if(e*=this.options.invertWheelDirection,n*=this.options.invertWheelDirection,this.hasVerticalScroll||(e=n,n=0),this.options.snap)return s=this.currentPage.pageX,o=this.currentPage.pageY,e>0?s--:0>e&&s++,n>0?o--:0>n&&o++,void this.goToPage(s,o);s=this.x+i.round(this.hasHorizontalScroll?e:0),o=this.y+i.round(this.hasVerticalScroll?n:0),s>0?s=0:s<this.maxScrollX&&(s=this.maxScrollX),o>0?o=0:o<this.maxScrollY&&(o=this.maxScrollY),this.scrollTo(s,o,0)}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var t,e,n,s,o,r,a=0,l=0,h=0,c=this.options.snapStepX||this.wrapperWidth,u=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(n=i.round(c/2),s=i.round(u/2);h>-this.scrollerWidth;){for(this.pages[a]=[],t=0,o=0;o>-this.scrollerHeight;)this.pages[a][t]={x:i.max(h,this.maxScrollX),y:i.max(o,this.maxScrollY),width:c,height:u,cx:h-n,cy:o-s},o-=u,t++;h-=c,a++}else for(r=this.options.snap,t=r.length,e=-1;t>a;a++)(0===a||r[a].offsetLeft<=r[a-1].offsetLeft)&&(l=0,e++),this.pages[l]||(this.pages[l]=[]),h=i.max(-r[a].offsetLeft,this.maxScrollX),o=i.max(-r[a].offsetTop,this.maxScrollY),n=h-i.round(r[a].offsetWidth/2),s=o-i.round(r[a].offsetHeight/2),this.pages[l][e]={x:h,y:o,width:r[a].offsetWidth,height:r[a].offsetHeight,cx:n,cy:s},h>this.maxScrollX&&l++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var t=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.x-this.startX),1e3),i.min(i.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,t)})},_nearestSnap:function(t,e){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var n=0,s=this.pages.length,o=0;if(i.abs(t-this.absStartX)<this.snapThresholdX&&i.abs(e-this.absStartY)<this.snapThresholdY)return this.currentPage;for(t>0?t=0:t<this.maxScrollX&&(t=this.maxScrollX),e>0?e=0:e<this.maxScrollY&&(e=this.maxScrollY);s>n;n++)if(t>=this.pages[n][0].cx){t=this.pages[n][0].x;break}for(s=this.pages[n].length;s>o;o++)if(e>=this.pages[0][o].cy){e=this.pages[0][o].y;break}return n==this.currentPage.pageX&&(n+=this.directionX,0>n?n=0:n>=this.pages.length&&(n=this.pages.length-1),t=this.pages[n][0].x),o==this.currentPage.pageY&&(o+=this.directionY,0>o?o=0:o>=this.pages[0].length&&(o=this.pages[0].length-1),e=this.pages[0][o].y),{x:t,y:e,pageX:n,pageY:o}},goToPage:function(t,e,n,s){s=s||this.options.bounceEasing,t>=this.pages.length?t=this.pages.length-1:0>t&&(t=0),e>=this.pages[t].length?e=this.pages[t].length-1:0>e&&(e=0);var o=this.pages[t][e].x,r=this.pages[t][e].y;n=void 0===n?this.options.snapSpeed||i.max(i.max(i.min(i.abs(o-this.x),1e3),i.min(i.abs(r-this.y),1e3)),300):n,this.currentPage={x:o,y:r,pageX:t,pageY:e},this.scrollTo(o,r,n,s)},next:function(t,e){var i=this.currentPage.pageX,n=this.currentPage.pageY;i++,i>=this.pages.length&&this.hasVerticalScroll&&(i=0,n++),this.goToPage(i,n,t,e)},prev:function(t,e){var i=this.currentPage.pageX,n=this.currentPage.pageY;i--,0>i&&this.hasVerticalScroll&&(i=0,n--),this.goToPage(i,n,t,e)},_initKeys:function(e){var i,n={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(i in this.options.keyBindings)"string"==typeof this.options.keyBindings[i]&&(this.options.keyBindings[i]=this.options.keyBindings[i].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(i in n)this.options.keyBindings[i]=this.options.keyBindings[i]||n[i];a.addEvent(t,"keydown",this),this.on("destroy",function(){a.removeEvent(t,"keydown",this)})},_key:function(t){if(this.enabled){var e,n=this.options.snap,s=n?this.currentPage.pageX:this.x,o=n?this.currentPage.pageY:this.y,r=a.getTime(),l=this.keyTime||0,h=.25;switch(this.options.useTransition&&this.isInTransition&&(e=this.getComputedPosition(),this._translate(i.round(e.x),i.round(e.y)),this.isInTransition=!1),this.keyAcceleration=200>r-l?i.min(this.keyAcceleration+h,50):0,t.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?s+=n?1:this.wrapperWidth:o+=n?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?s-=n?1:this.wrapperWidth:o-=n?1:this.wrapperHeight;break;case this.options.keyBindings.end:s=n?this.pages.length-1:this.maxScrollX,o=n?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:s=0,o=0;break;case this.options.keyBindings.left:s+=n?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:o+=n?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:s-=n?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:o-=n?1:5+this.keyAcceleration>>0;break;default:return}if(n)return void this.goToPage(s,o);s>0?(s=0,this.keyAcceleration=0):s<this.maxScrollX&&(s=this.maxScrollX,this.keyAcceleration=0),o>0?(o=0,this.keyAcceleration=0):o<this.maxScrollY&&(o=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(s,o,0),this.keyTime=r}},_animate:function(t,e,i,n){function s(){var p,d,f,g=a.getTime();return g>=u?(o.isAnimating=!1,o._translate(t,e),void(o.resetPosition(o.options.bounceTime)||o._execEvent("scrollEnd"))):(g=(g-c)/i,f=n(g),p=(t-l)*f+l,d=(e-h)*f+h,o._translate(p,d),void(o.isAnimating&&r(s)))}var o=this,l=this.x,h=this.y,c=a.getTime(),u=c+i;this.isAnimating=!0,s()},handleEvent:function(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(t);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(t);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(t);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(t);break;case"keydown":this._key(t);break;case"click":t._constructed||(t.preventDefault(),t.stopPropagation())}}},o.prototype={handleEvent:function(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(t);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(t)}},destroy:function(){this.options.interactive&&(a.removeEvent(this.indicator,"touchstart",this),a.removeEvent(this.indicator,a.prefixPointerEvent("pointerdown"),this),a.removeEvent(this.indicator,"mousedown",this),a.removeEvent(t,"touchmove",this),a.removeEvent(t,a.prefixPointerEvent("pointermove"),this),a.removeEvent(t,"mousemove",this),a.removeEvent(t,"touchend",this),a.removeEvent(t,a.prefixPointerEvent("pointerup"),this),a.removeEvent(t,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(e){var i=e.touches?e.touches[0]:e;e.preventDefault(),e.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=i.pageX,this.lastPointY=i.pageY,this.startTime=a.getTime(),this.options.disableTouch||a.addEvent(t,"touchmove",this),this.options.disablePointer||a.addEvent(t,a.prefixPointerEvent("pointermove"),this),this.options.disableMouse||a.addEvent(t,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(t){var e,i,n,s,o=t.touches?t.touches[0]:t;a.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,e=o.pageX-this.lastPointX,this.lastPointX=o.pageX,i=o.pageY-this.lastPointY,this.lastPointY=o.pageY,n=this.x+e,s=this.y+i,this._pos(n,s),t.preventDefault(),t.stopPropagation()},_end:function(e){if(this.initiated){if(this.initiated=!1,e.preventDefault(),e.stopPropagation(),a.removeEvent(t,"touchmove",this),a.removeEvent(t,a.prefixPointerEvent("pointermove"),this),a.removeEvent(t,"mousemove",this),this.scroller.options.snap){var n=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),s=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.scroller.x-n.x),1e3),i.min(i.abs(this.scroller.y-n.y),1e3)),300);(this.scroller.x!=n.x||this.scroller.y!=n.y)&&(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=n,this.scroller.scrollTo(n.x,n.y,s,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(t){t=t||0,this.indicatorStyle[a.style.transitionDuration]=t+"ms",!t&&a.isBadAndroid&&(this.indicatorStyle[a.style.transitionDuration]="0.001s")},transitionTimingFunction:function(t){this.indicatorStyle[a.style.transitionTimingFunction]=t},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(a.addClass(this.wrapper,"iScrollBothScrollbars"),a.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(a.removeClass(this.wrapper,"iScrollBothScrollbars"),a.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=i.max(i.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=i.max(i.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var t=this.options.listenX&&i.round(this.sizeRatioX*this.scroller.x)||0,e=this.options.listenY&&i.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(t<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=i.max(this.indicatorWidth+t,8),this.indicatorStyle.width=this.width+"px"),t=this.minBoundaryX):t>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=i.max(this.indicatorWidth-(t-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",t=this.maxPosX+this.indicatorWidth-this.width):t=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),e<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=i.max(this.indicatorHeight+3*e,8),this.indicatorStyle.height=this.height+"px"),e=this.minBoundaryY):e>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=i.max(this.indicatorHeight-3*(e-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",e=this.maxPosY+this.indicatorHeight-this.height):e=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=t,this.y=e,this.scroller.options.useTransform?this.indicatorStyle[a.style.transform]="translate("+t+"px,"+e+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=t+"px",this.indicatorStyle.top=e+"px")},_pos:function(t,e){0>t?t=0:t>this.maxPosX&&(t=this.maxPosX),0>e?e=0:e>this.maxPosY&&(e=this.maxPosY),
t=this.options.listenX?i.round(t/this.sizeRatioX):this.scroller.x,e=this.options.listenY?i.round(e/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(t,e)},fade:function(t,e){if(!e||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var i=t?250:500,n=t?0:300;t=t?"1":"0",this.wrapperStyle[a.style.transitionDuration]=i+"ms",this.fadeTimeout=setTimeout(function(t){this.wrapperStyle.opacity=t,this.visible=+t}.bind(this,t),n)}}},n.utils=a,"undefined"!=typeof module&&module.exports?module.exports=n:t.IScroll=n}(window,document,Math),define("iscroll",function(t){return function(){var e;return e||t.IScroll}}(this)),define("app/ui/layout/flap",["jquery","iscroll"],function(t,e){var i=function(e){e=e||{},this.config=t.extend({debug:!1,flap:null,side:null,button:null,backdrop:null,mobileMaxWidth:992},e),this.$flap=t(this.config.flap),this.$button=t(this.config.button),this.$backdrop=t(this.config.backdrop),this.iscroll=null,this.mobile=null,this.clickHandlersEnabled=!1,this.scrollHandlersEnabled=!1,this.opened=!1;var i=this;this.log=function(t){i.config.debug&&console.log("[Flap "+this.config.side+"] "+t)},this.buttonClickHandler=function(){i.log("Button click handler"),i.open()},this.backdropClickHandler=function(){i.log("Overlay click handler"),i.close()}};return i.prototype.init=function(){this.log("Flap init");var t=window.innerWidth<this.config.mobileMaxWidth;t!=this.mobile&&(this.close(),this.disableScrollHandlers(),t?this.enableClickHandlers():(this.disableClickHandlers(),this.enableScrollHandlers())),this.mobile=t,this.iscroll&&this.iscroll.refresh()},i.prototype.enableClickHandlers=function(){this.clickHandlersEnabled||(this.log("enableClickHandlers"),this.$button.on("click",this.buttonClickHandler),this.$backdrop.on("click",this.backdropClickHandler),this.clickHandlersEnabled=!0)},i.prototype.disableClickHandlers=function(){this.clickHandlersEnabled&&(this.log("disableClickHandlers"),this.$button.off("click",this.buttonClickHandler),this.$backdrop.off("click",this.backdropClickHandler),this.clickHandlersEnabled=!1)},i.prototype.enableScrollHandlers=function(){this.scrollHandlersEnabled||(this.log("enableScrollHandlers"),this.iscroll=new e(this.config.flap,{mouseWheel:!0}),this.scrollHandlersEnabled=!0)},i.prototype.disableScrollHandlers=function(){this.scrollHandlersEnabled&&(this.log("disableScrollHandlers"),this.iscroll.destroy(),this.iscroll=null,this.scrollHandlersEnabled=!1)},i.prototype.open=function(){return this.opened?this:(this.opened=!0,t("body").addClass("flap-opened").addClass(this.config.side),this.$flap.css({top:0}),void this.enableScrollHandlers())},i.prototype.close=function(){return this.opened?(t("body").removeClass("flap-opened").removeClass(this.config.side),this.$flap.css({top:0}),this.disableScrollHandlers(),void(this.opened=!1)):this},i}),define("app/ui/layout/interact",["jquery"],function(t){var e=function(e){this.config=t.extend({debug:!1},e)};return e.prototype.log=function(){return this.config.debug&&console.log("[Interact] "+arguments[0],Array.prototype.splice.call(arguments,1)),this},e.prototype.init=function(){this.log("init()");var t=this,e=0,i=setInterval(function(){return t.log("check ga",e,typeof ga),"function"==typeof ga?(t.initHandlers(),void clearInterval(i)):(e++,void(e>20&&clearInterval(i)))},500);return this},e.prototype.initHandlers=function(){this.log("initHandlers()");var e=this,i=t("body"),n="control";return i.on("etalia.control.search.change",function(t,i){var s={hitType:"event",eventCategory:n,eventAction:"search",eventLabel:i.expression};e.log("ga.send()",s),ga("send",s)}).on("etalia.control.timespan.change",function(t,i){var s={hitType:"event",eventCategory:n,eventAction:"timespan",eventLabel:i.label,eventValue:i.value};e.log("ga.send()",s),ga("send",s)}).on("etalia.control.cluster.change",function(t,i){var s={hitType:"event",eventCategory:n,eventAction:"cluster",eventLabel:i.label,eventValue:i.value};e.log("ga.send()",s),ga("send",s)}).on("etalia.control.pinned.change",function(t,i){var s={hitType:"event",eventCategory:n,eventAction:i.active?"pin":"unpin"};e.log("ga.send()",s),ga("send",s)}).on("etalia.control.filters.change",function(t,i){var s={hitType:"event",eventCategory:n,eventAction:(i.active?"select_":"deselect_")+i.group,eventLabel:i.label,eventValue:i.value};e.log("ga.send()",s),ga("send",s)}).on("etalia.control.filters.more",function(t,i){var s={hitType:"event",eventCategory:n,eventAction:"more_filter",eventLabel:i.group};e.log("ga.send()",s),ga("send",s)}),i.on("etalia.publication.pin",function(t,i){var n={hitType:"event",eventCategory:i.getExtra("source"),eventAction:i.isPinned()?"pin":"unpin",eventLabel:i.getExtra("title"),eventValue:i.getId()};e.log("ga.send()",n),ga("send",n)}).on("etalia.publication.ban",function(t,i){var n={hitType:"event",eventCategory:i.getExtra("source"),eventAction:"ban",eventLabel:i.getExtra("title"),eventValue:i.getId()};e.log("ga.send()",n),ga("send",n)}).on("etalia.publication.add",function(t,i){var n={hitType:"event",eventCategory:i.getExtra("source"),eventAction:"add",eventLabel:i.getExtra("title"),eventValue:i.getId()};e.log("ga.send()",n),ga("send",n)}).on("etalia.publication.trash",function(t,i){var n={hitType:"event",eventCategory:i.getExtra("source"),eventAction:"trash",eventLabel:i.getExtra("title"),eventValue:i.getId()};e.log("ga.send()",n),ga("send",n)}).on("etalia.publication.restore",function(t,i){var n={hitType:"event",eventCategory:i.getExtra("source"),eventAction:"restore",eventLabel:i.getExtra("title"),eventValue:i.getId()};e.log("ga.send()",n),ga("send",n)}).on("etalia.publication.trash-clear",function(){var t={hitType:"event",eventCategory:"library",eventAction:"trash-clear"};e.log("ga.send()",t),ga("send",t)}).on("etalia.publication.share",function(t,i){var n={hitType:"event",eventCategory:i.source,eventAction:"share_"+i.support,eventLabel:i.title,eventValue:i.id};e.log("ga.send()",n),ga("send",n)}),i.on("etalia.detail.similar_timespan.change",function(t,i){var n={hitType:"event",eventCategory:"detail",eventAction:"similar_timespan",eventLabel:i.title,eventValue:i.value};e.log("ga.send()",n),ga("send",n)}),this},(new e).init()}),define("app/ui/layout/invite",["jquery"],function(t){function e(e){e.preventDefault();var n=i.find(".modal-form"),s=i.find(".modal-result");return t.ajax({type:n.attr("method"),url:n.attr("action"),data:n.serialize(),success:function(t){i.find(".form-errors").empty(),n.hide().find("input, textarea").val(""),s.show()},error:function(e){console.log(e.responseText);var n=i.find(".form-errors").empty(),s=JSON.parse(e.responseText);t.each(s,function(t,e){n.prepend('<div class="alert alert-danger" role="alert"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>'+e+"</div>")})}}),!1}var i;t(function(){i=t("#invite-modal"),t("#open-invite").on("click",function(){t("#profile-dropdown").hide(),i.modal("show")}),i.find("form[data-async]").on("submit",e),i.find(".form-errors").empty(),i.on("hidden.bs.modal",function(){i.find(".modal-form").show(),i.find(".modal-result").hide()})})}),define("app/ui/layout/close-alerts",["jquery"],function(t){t(function(){t("a.close[close-href]").click(function(e){e.preventDefault(),t.post(t(this).attr("close-href"),"",function(){})})})}),define("app/ui/layout",["jquery","app/util/utils","app/ui/layout/flap","app/ui/layout/interact","app/ui/layout/invite","app/ui/layout/close-alerts"],function(t,e,i){var n=function(e){this.config=t.extend({debug:!1,leftFlap:"#nav-flap",leftFlapButton:"#toggle-nav",rightFlap:"#filter-flap",rightFlapButton:"#toggle-filter",backdrop:"#backdrop"},e),this.leftFlap=null,this.rightFlap=null,this.busy=!1;var i=this;this.log=function(t){i.config.debug&&console.log("[Layout] "+t)},this.resizeTimeout=null,this.resizeHandler=function(){i.log("Resize handler"),i.leftFlap&&i.leftFlap.init(),i.rightFlap&&i.rightFlap.init()}};n.prototype.init=function(){var n=t(this.config.leftFlap),s=t(this.config.leftFlapButton),o=t(this.config.rightFlap),r=t(this.config.rightFlapButton),a=!1;if(this.log("Init"),n.length?(this.log("Left flap found"),this.leftFlap=new i({debug:this.config.debug,flap:this.config.leftFlap,side:"left",button:this.config.leftFlapButton,backdrop:this.config.backdrop,mobileMaxWidth:992}),a=!0):s.hide(),o.length?(this.log("Right flap found"),this.rightFlap=new i({debug:this.config.debug,flap:this.config.rightFlap,side:"right",button:this.config.rightFlapButton,backdrop:this.config.backdrop,mobileMaxWidth:1200}),a=!0):r.hide(),a){var l=this;t(window).on("resize",function(){l.resizeTimeout&&clearTimeout(l.resizeTimeout),l.resizeTimeout=setTimeout(l.resizeHandler,100)}),l.resizeHandler()}var h=t("#toggle-profile"),c=t("#profile-dropdown");c.length&&(h.on("click",function(i){e.toggleClass(t(i.delegateTarget),"active")?c.show():c.hide()}),c.on("click",function(t){t.stopPropagation()}),t(window).on("click",function(e){0==t(e.target).closest("#toggle-profile").length&&(t("#toggle-profile").removeClass("active"),t("#profile-dropdown").hide())}))},n.prototype.setBusy=function(e){t("#busy-content").html(e),this.busy||(this.busy=!0,t("body").addClass("busy"))},n.prototype.setAvailable=function(){this.busy&&(this.busy=!1,t("#busy-content").html(""),t("body").removeClass("busy"))};var s=new n;return s.init(),s}),define("app/feed/paper",["jquery","app/ui/paper","app/ui/layout","bootstrap"],function(t,e){t(function(){var i=new e;i.init().update(),t("body").on("etalia.publication.ban",function(t,e){e.isBanned()&&(window.location.href="/feed/stream")})})});