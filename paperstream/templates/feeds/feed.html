{% extends 'base.html' %}

{% load staticfiles %}
{% load disqus_tags %}
{% load user_taste %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/feeds.css' %}" type="text/css" >
    {{ block.super }}
{% endblock css %}

{% block title %}
    User Feed
{% endblock title %}

{% block content %}
    {% if user.lib.state == 'ING' %}
        {% include "user/sync_lib_modal.html" %}
    {% elif userfeed.state == 'ING' %}
        {% include "feeds/update_feed_modal.html" %}
    {% endif %}
    <div class="container-fluid">
        <div class="feed">
            <div class="row">
                <div class="col-lg-11 col-lg-offset-1">
                    <div class="col-md-8">
                        <div class="userfeed">
                            {% include page_template %}
                        </div>
                    </div>
                    <div class="col-md-3 hidden-sm">
                        <div class="side-panel">
                            <div class="side-panel-title">Statistics</div>
                            <div class="side-panel-inner">
                                <h5>Paperstream Library</h5>
                                <div class="side-panel-inner">
                                    <h5>{{ stats.nb_papers }} papers </h5>
                                    <h5>{{ stats.nb_journals }} journals </h5>
                                    <h5>{{ stats.nb_authors }} authors </h5>
                                    <h5>{{ stats.nb_papers_last_week }} papers last week</h5>
                                    <h5>{{ stats.nb_papers_last_month }} papers last month</h5>
                                </div>
                                <h5>My Library</h5>
                                <div class="side-panel-inner">
                                    <h5>{{ user.lib.count_papers }} papers</h5>
                                    <h5>{{ user.lib.count_journals }} journals</h5>
                                    <h5>{{ user.lib.count_authors }} authors</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


{#                    <div class="col-lg-1"></div>#}
{#                    <div class="col-lg-10">#}
{#                        <ul class="list-group">#}
{#                            <div>#}
{#                                <span  class="title">{{ userfeed.name }}</span>#}
{#                                <a href="{% url 'feeds:modify-feed' userfeed.pk %}">(Settings)</a>#}
{#                                {% if not userfeed.name == 'main' %}#}
{#                                    <a href="{% url 'feeds:delete-feed' userfeed.pk %}">(Delete)</a>#}
{#                                {% endif %}#}
{#                                <a href="{% url 'feeds:update-feed' userfeed.pk %}">(Update)</a>#}
{#                            </div>#}
{##}
{#                            {% for ufp in object_list %}#}
{#                                <li id="{{ ufp.id }}" class="list-group-item">#}
{#                                    <div class="btn-group pull-right" role="group" aria-label="...">#}
{#                                        <span class="btn-group dislike"  role="group">#}
{#                                            <button class="btn {% if user_taste|get_is_disliked:ufp.paper.pk %} btn-info {% else %} btn-default {% endif %} btn-sm" type="button">#}
{#                                                <span class="glyphicon glyphicon-minus"></span>#}
{#                                            </button>#}
{#                                        </span>#}
{#                                        <span class="btn-group like" role="group">#}
{#                                            <button class="btn {% if user_taste|get_is_liked:ufp.paper.pk %} btn-info {% else %} btn-default {% endif %} btn-sm" type="button">#}
{#                                                <span class="glyphicon glyphicon-plus"></span></button>#}
{#                                        </span>#}
{#                                    </div>#}
{##}
{#                                    <span class="paper-link" id="paper-link{{ ufp.id }}" data-ufpid="{{ ufp.id }}">#}
{#                                        <a id="paper-title{{ ufp.id }}" class="list-group-item-heading" href="{% url 'library:paper' ufp.paper.pk %}"> <strong>{{ ufp.paper.title }}</strong></a>#}
{#                                        <a href="{{ ufp.paper.url }}" target="_blank"><strong>(link)</strong></a>#}
{#                                        <span>(score: {{ufp.print_score}})</span>#}
{#                                    </span>#}
{#                                    <span class="btn-group pull-right">#}
{#                                        {% if ufp.paper.id_doi %}<div class='altmetric-embed' data-badge-type='donut' data-doi="{{ ufp.paper.id_doi }}"></div>#}
{#                                        {% elif ufp.paper.id_arx %}<div class='altmetric-embed' data-badge-type='donut' data-arxiv="{{ ufp.paper.id_arx }}"></div>#}
{#                                        {% elif ufp.paper.id_pmi %}<div class='altmetric-embed' data-badge-type='donut' data-pmid="{{ ufp.paper.id_pmi }}"></div>#}
{#                                        {% endif %}#}
{#                                    </span>#}
{#                                    <p class="list-group-item-text"><em>{{ ufp.paper.print_full_authors }}</em></p>#}
{#                                    <p><i>in</i> {{ ufp.paper.print_journal_title }} -  {{ ufp.paper.print_date }}</p>#}
{##}
{#                                    <a href="{% url 'library:paper' ufp.paper.pk %}#disqus_thread" data-disqus-identifier="{{ ufp.paper.pk }}">View Comments</a>#}
{#                                    {% disqus_num_replies %}#}
{##}
{#                                    <p id="abstract{{ ufp.id }}" class="abstract list-group-item-text"><b>Abstract:</b> {{ ufp.paper.abstract }}</p>#}
{#                                </li>#}
{#                                <br>#}
{#                            {% endfor %}#}
{#                        </ul>#}
{#                    </div>#}
{#                    <div class="col-lg-1"></div>#}
            </div>
        </div>
    </div>
{% endblock content %}

{% block js %}
    <script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="{{ STATIC_URL }}endless_pagination/js/endless-pagination.js"></script>
    <script type="text/javascript" src="{% static 'js/feeds.js' %}"></script>
    <script>$.endlessPaginate({
        paginateOnScroll: true,
        paginateOnScrollMargin: 10,
        onClick: function () {
            extendPaper();
            toggleStamps();
        },
        onCompleted: function () {
            extendPaper();
            toggleStamps();
            like();
            dislike();
        }
    });
    </script>

    {{ block.super }}
{% endblock js %}

